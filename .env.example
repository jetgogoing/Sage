# Sage MCP 完整环境配置示例
# 基于单容器 STDIO 架构优化
# 复制此文件为 .env 并根据您的环境修改相应的值

# ===== 必需配置 =====

# 项目根目录配置（自动检测，可选覆盖）
# Windows示例: SAGE_HOME=C:\Projects\Sage
# macOS示例: SAGE_HOME=/Users/yourname/Sage
# Linux示例: SAGE_HOME=/home/yourname/Sage
# 留空则自动检测当前项目位置
SAGE_HOME=

# SiliconFlow API 配置（用于向量嵌入）
# 请从 https://siliconflow.cn 获取您的 API 密钥
SILICONFLOW_API_KEY=your_siliconflow_api_key_here

# 数据库配置（单容器内部使用）
DB_HOST=localhost
DB_PORT=5432
DB_NAME=sage_memory
DB_USER=sage
# 警告：必须设置强密码，不能使用默认值
DB_PASSWORD=sage123

# 数据库 URL（容器内部连接）
# 注意：密码需要与上面的DB_PASSWORD保持一致
DATABASE_URL=postgresql://sage:sage123@localhost:5432/sage_memory

# ===== 记忆检索配置 =====

# 返回的记忆条数（影响检索质量和性能）
SAGE_MAX_RESULTS=100

# 相似度阈值（0-1，用于过滤搜索结果，越高越严格）
SAGE_SIMILARITY_THRESHOLD=0.3

# 启用智能摘要（使用 LLM 压缩长对话）
# 注意：单容器版本建议暂时禁用，减少依赖
SAGE_ENABLE_SUMMARY=true  # 启用 LLM 智能压缩功能

# ===== Reranker 配置 =====

# Reranker 候选 chunk 数量（送入重排的数量）
SAGE_RERANKER_CANDIDATES=200     # 默认 100，建议范围 50-200

# Reranker 返回的 top_k 数量（最终发给 Claude 的数量）
SAGE_RERANKER_TOP_K=20           # 默认 10，建议范围 5-20

# 最大输出 token 限制（防止超出 Claude 额度）
SAGE_MAX_OUTPUT_TOKENS=3000      # 默认 2000，建议不超过 3000

# ===== 性能优化配置 =====

# 缓存配置
SAGE_CACHE_SIZE=4096              # 缓存大小
SAGE_CACHE_TTL=43200              # 缓存过期时间（秒）

# 资源限制
SAGE_MAX_MEMORY_MB=8192          # 最大内存限制（MB）
SAGE_MAX_CONCURRENT_OPS=10        # 最大并发操作数

# ===== 自动功能配置 =====

# 自动保存配置
SAGE_AUTO_SAVE_ENABLED=true      # 启用自动保存
SAGE_AUTO_SAVE_MIN_MESSAGES=2    # 自动保存最小消息数
SAGE_AUTO_SAVE_IDLE_TIMEOUT=300  # 自动保存空闲超时（秒）

# 自动上下文注入
SAGE_AUTO_CONTEXT_INJECTION=true # 自动注入相关记忆到对话
SAGE_TRANSPARENT_MEMORY=true     # 透明记忆模式（无需用户感知）

# ===== 日志配置 =====

# 日志级别：DEBUG, INFO, WARNING, ERROR
SAGE_LOG_LEVEL=INFO
SAGE_DEBUG=false                 # 调试模式开关
SAGE_LOG_FILE=/tmp/sage_mcp.log  # 日志文件路径

# ===== 应用配置 =====

# Sage 运行环境
SAGE_ENV=production              # development/production

# 会话配置
SAGE_DEFAULT_SESSION_ID=default  # 默认会话ID
SAGE_SESSION_TIMEOUT=86400       # 会话超时时间（秒，默认24小时）

# ===== 实验性功能 =====

# 启用实验性功能（谨慎使用）
SAGE_EXPERIMENTAL_FEATURES=false

# 智能提示生成
SAGE_SMART_PROMPT_ENABLED=true   # 启用AI增强的提示生成

# 记忆分析功能
SAGE_MEMORY_ANALYSIS_ENABLED=true # 启用记忆模式分析

# ===== Docker 特定配置 =====

# PostgreSQL 容器配置
POSTGRES_USER=sage
# 必须与DB_PASSWORD保持一致
POSTGRES_PASSWORD=sage123
POSTGRES_DB=sage_memory

# 注意：以下配置已经内置，通常不需要修改
# MCP_SERVER_HOST=0.0.0.0       # STDIO 模式不需要
# MCP_SERVER_PORT=17800         # STDIO 模式不需要

# ===========================================
# 配置说明
# ===========================================
#
# 必填配置项:
# - SILICONFLOW_API_KEY: 用于文本向量化的API密钥
# - DB_PASSWORD: 数据库密码（必须使用强密码）
# - POSTGRES_PASSWORD: PostgreSQL管理员密码（与DB_PASSWORD相同）
#
# 性能调优建议:
# - SAGE_MAX_RESULTS: 增加可提高召回率，但影响性能
# - SAGE_CACHE_SIZE: 根据内存情况调整
# - SAGE_MAX_CONCURRENT_OPS: 根据CPU核心数调整
#
# 功能开关:
# - SAGE_AUTO_SAVE_ENABLED: 关闭可减少数据库写入
# - SAGE_AUTO_CONTEXT_INJECTION: 关闭可提高响应速度
# - SAGE_SMART_PROMPT_ENABLED: 实验性功能，可能影响稳定性
#
# 生产环境建议:
# - 使用强密码（至少16位，包含大小写字母、数字和特殊字符）
# - 设置SAGE_ENV=production
# - 关闭SAGE_DEBUG
# - 适当调整SAGE_LOG_LEVEL（建议INFO或WARNING）
# - 定期轮换API密钥和数据库密码