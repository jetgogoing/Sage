# 配置 Sage MCP Server 执行报告

## 任务概述
- **目标**：为 Claude Code 配置 Sage MCP Server
- **时间**：2025-07-17 00:14:13
- **需求来源**：用户请求配置 sage mcp server

## 修改范围与文件变动

### 1. 创建 MCP 配置文件
- **文件**：`~/.config/claude/mcp.json` (新建)
- **原因**：Claude Code 需要此配置文件来识别和连接 MCP 服务器

配置内容：
```json
{
  "mcpServers": {
    "sage": {
      "command": "python",
      "args": ["/Users/jet/sage/sage_mcp_stdio_single.py"],
      "env": {
        "DB_HOST": "localhost",
        "DB_PORT": "5432",
        "DB_NAME": "sage_memory",
        "DB_USER": "sage",
        "DB_PASSWORD": "sage123",
        "EMBEDDING_MODEL": "Qwen/Qwen3-Embedding-8B",
        "EMBEDDING_DEVICE": "cpu",
        "SAGE_LOG_DIR": "/Users/jet/sage/logs",
        "PYTHONPATH": "/Users/jet/sage"
      }
    }
  }
}
```

### 2. 创建日志目录
- **路径**：`~/sage/logs/` (新建)
- **原因**：MCP 服务器需要写入日志，避免权限问题

## 配置说明

1. **服务器入口**：使用 `sage_mcp_stdio_single.py` 作为 STDIO 版本的 MCP 服务器
2. **数据库配置**：连接本地 PostgreSQL 数据库 (sage_memory)
3. **嵌入模型**：使用 Qwen3-Embedding-8B 模型，运行在 CPU 上
4. **环境变量**：
   - `SAGE_LOG_DIR`：日志文件存放目录
   - `PYTHONPATH`：确保能正确导入 sage_core 模块

## 使用方法

配置完成后，需要重启 Claude Code 以加载新的 MCP 配置：

1. 退出当前 Claude Code 会话
2. 重新启动 Claude Code
3. 使用命令 `claude mcp` 查看已配置的服务器
4. Sage MCP Server 将自动启动并提供记忆存储服务

## 后续建议

1. **验证连接**：重启后使用 MCP 工具测试与 Sage 的连接
2. **数据库准备**：确保 PostgreSQL 已启动且数据库架构已初始化
3. **性能优化**：如有 GPU 可用，可将 `EMBEDDING_DEVICE` 改为 "cuda"
4. **日志监控**：定期查看 `~/sage/logs/` 中的日志文件

## 注意事项

- MCP 配置文件路径为 `~/.config/claude/mcp.json`
- 确保 Python 环境已安装所需依赖（mcp, sage_core 等）
- 数据库连接信息需与实际环境匹配