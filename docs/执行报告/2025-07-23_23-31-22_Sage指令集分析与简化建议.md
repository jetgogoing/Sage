# Sage MCP 指令集分析与简化建议

## 执行概要
- **任务**: 分析Sage默认指令集并提供简化建议
- **时间**: 2025-07-23 23:31:22
- **状态**: 完成分析，待用户决策

## 当前指令集分析

### 1. 核心记忆管理指令（3个）

#### save_conversation
- **作用**: 保存用户和助手的对话到记忆系统
- **参数**: 
  - user_prompt: 用户输入
  - assistant_response: 助手回复
  - metadata: 可选元数据
- **使用频率**: 高（自动调用）

#### search_memory
- **作用**: 搜索记忆库中的历史对话
- **参数**:
  - query: 搜索查询
  - limit: 结果数量限制（默认10）
  - strategy: 搜索策略（default/semantic/recent）
  - session_id: 可选会话ID过滤
- **使用频率**: 中

#### get_context
- **作用**: 根据查询获取相关的历史上下文
- **参数**:
  - query: 查询内容
  - max_results: 最大返回结果数（默认10）
- **使用频率**: 高（自动调用）

### 2. 会话管理指令（2个）

#### manage_session
- **作用**: 管理会话（创建、切换、查看、列表）
- **参数**:
  - action: 操作类型（create/switch/info/list）
  - session_id: 会话ID（部分操作需要）
- **使用频率**: 低

#### export_session
- **作用**: 导出会话数据
- **参数**:
  - session_id: 要导出的会话ID
  - format: 导出格式（json/markdown）
- **使用频率**: 低

### 3. 智能分析指令（2个）

#### analyze_memory
- **作用**: 分析记忆库，生成洞察和模式
- **参数**:
  - session_id: 可选会话ID
  - analysis_type: 分析类型（general/patterns/insights）
- **使用频率**: 低

#### generate_prompt
- **作用**: 基于上下文生成智能提示
- **参数**:
  - context: 上下文信息
  - style: 提示风格（default/question/suggestion）
- **使用频率**: 低

### 4. 系统状态指令（1个）

#### get_status
- **作用**: 获取Sage服务状态
- **参数**: 无
- **使用频率**: 低

## 简化建议

### 方案一：精简版（推荐）
保留核心功能，移除低频使用的指令：

**保留指令（4个）**：
1. `save_conversation` - 核心功能，必须保留
2. `search_memory` - 手动搜索记忆
3. `get_context` - 自动上下文注入
4. `manage_session` - 基础会话管理

**移除指令（4个）**：
- `export_session` - 使用频率极低
- `analyze_memory` - 功能过于复杂，实际使用少
- `generate_prompt` - 价值不明显
- `get_status` - 调试用途，普通用户不需要

### 方案二：极简版
只保留最核心的自动功能：

**保留指令（2个）**：
1. `save_conversation` - 自动保存对话
2. `get_context` - 自动注入上下文

**优化建议**：
- 将 `search_memory` 功能整合到 `get_context` 中
- 移除所有手动管理功能

### 方案三：重新设计
基于实际使用场景重新设计指令集：

**新指令集（3个）**：
1. `memory` - 统一的记忆管理
   - 子命令: save/search/clear
2. `context` - 上下文管理
   - 自动模式和手动模式
3. `session` - 会话管理
   - 子命令: new/switch/list

## 实施建议

### 1. 短期优化（1-2天）
- 采用方案一，快速精简指令集
- 保留向后兼容性
- 更新文档

### 2. 中期改进（1周）
- 收集用户反馈
- 分析实际使用数据
- 优化核心指令的参数

### 3. 长期规划（1个月）
- 考虑方案三的重新设计
- 实现更智能的自动化功能
- 减少用户手动操作需求

## 技术实现说明

当前指令定义在 `/Users/jet/Sage/sage_mcp_stdio_single.py` 文件中：
- 第71-229行：工具定义
- 第231-375行：工具处理逻辑

简化时需要：
1. 删除不需要的Tool定义
2. 移除对应的处理逻辑
3. 更新文档和测试

## 结论

建议采用**方案一（精简版）**，理由：
1. 保留了核心功能
2. 移除了低频使用的复杂功能
3. 用户体验更简洁
4. 维护成本降低
5. 保持向后兼容性

这样可以让Sage更专注于其核心价值：智能记忆管理和上下文注入。