# MCP连接诊断与STDIO架构发现执行报告

## 任务概述
- **目标**：诊断MCP连接问题，理解Sage MCP服务的运行机制
- **需求来源**：用户请求保存关于MCP连接诊断的对话

## 关键发现

### 1. STDIO模式架构设计
- **发现**：Sage MCP服务采用STDIO（标准输入/输出）模式，设计为按需启动而非持续运行
- **运行机制**：
  - Docker容器仅运行PostgreSQL数据库服务
  - MCP服务通过`docker exec`命令在需要时动态调用
  - 服务不是作为守护进程持续运行

### 2. Docker容器配置
- **容器名称**：sage-single-minimal
- **运行服务**：
  - PostgreSQL（持续运行）
  - Sage MCP服务（按需调用）

### 3. MCP服务调用方式
```bash
# MCP服务通过docker exec按需调用
docker exec -i sage-single-minimal python /app/sage_mcp_server.py
```

## 诊断过程记录

### 问题症状
- 尝试连接MCP服务时显示连接失败
- Docker容器正常运行但找不到MCP进程

### 排查步骤
1. 检查Docker容器状态 - 容器正常运行
2. 查看容器内运行进程 - 仅发现PostgreSQL进程
3. 分析启动脚本和配置文件 - 发现STDIO模式设计
4. 确认MCP服务的按需启动机制

## 架构理解

### STDIO模式优势
1. **资源效率**：服务仅在需要时运行，减少资源占用
2. **简化部署**：无需管理额外的服务进程
3. **隔离性**：每次调用都是独立的进程实例

### 配置文件结构
- MCP配置指定了通过`docker exec`调用服务
- Claude Desktop通过配置文件知道如何启动MCP服务
- 服务启动命令包含在配置中而非作为独立服务运行

## 后续建议

1. **文档更新**：建议在项目文档中明确说明STDIO模式的工作原理
2. **调试方法**：测试MCP连接时应通过`docker exec`命令验证
3. **监控考虑**：由于服务按需启动，传统的进程监控方法不适用

## 注意事项

- STDIO模式下，MCP服务不会出现在常规进程列表中
- 调试时需要通过实际调用来验证服务功能
- Docker容器主要作为PostgreSQL数据库和Python环境的载体

---
*报告生成时间：2025-07-16 17:12:14*