# Sage MCP å®Œæ•´ä½¿ç”¨æŒ‡å—

## ğŸš€ ä»é›¶å¼€å§‹ä½¿ç”¨ Sage MCP

æœ¬æŒ‡å—å°†å¸¦æ‚¨å®Œæˆä»ç”µè„‘é‡å¯åˆ°æˆåŠŸä½¿ç”¨ Sage MCP çš„å…¨è¿‡ç¨‹ã€‚

## ğŸ“‹ å‰ç½®è¦æ±‚

### ç³»ç»Ÿç¯å¢ƒ
- macOSã€Linux æˆ– Windows (WSL2)
- Python 3.8 æˆ–æ›´é«˜ç‰ˆæœ¬
- Docker Desktop å·²å®‰è£…å¹¶è¿è¡Œ
- Claude Code CLI å·²å®‰è£…
- Git å·²é…ç½®

### API å¯†é’¥
- [SiliconFlow API Key](https://siliconflow.cn) - ç”¨äºå‘é‡åµŒå…¥å’Œé‡æ’åº

## ğŸ”§ å®Œæ•´å¯åŠ¨æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šç³»ç»Ÿç¯å¢ƒæ£€æŸ¥

```bash
# 1. æ£€æŸ¥ Python ç‰ˆæœ¬
python3 --version
# æœŸæœ›è¾“å‡º: Python 3.8.x æˆ–æ›´é«˜

# 2. æ£€æŸ¥ Docker çŠ¶æ€
docker --version
docker ps
# æœŸæœ›è¾“å‡º: Docker ç‰ˆæœ¬ä¿¡æ¯ï¼Œä¸”èƒ½çœ‹åˆ°å®¹å™¨åˆ—è¡¨ï¼ˆå¯èƒ½ä¸ºç©ºï¼‰

# 3. æ£€æŸ¥ Claude Code
claude --version
# æœŸæœ›è¾“å‡º: Claude Code ç‰ˆæœ¬ä¿¡æ¯
```

### ç¬¬äºŒæ­¥ï¼šå¯åŠ¨ Docker å’Œæ•°æ®åº“

```bash
# 1. å¯åŠ¨ Docker Desktopï¼ˆå¦‚æœè¿˜æ²¡å¯åŠ¨ï¼‰
# macOS: æ‰“å¼€ Docker.app
# Linux: sudo systemctl start docker

# 2. è¿›å…¥ Sage é¡¹ç›®ç›®å½•
cd "/Users/jet/sage"

# 3. å¯åŠ¨ PostgreSQL æ•°æ®åº“
docker-compose up -d postgres

# 4. ç­‰å¾…æ•°æ®åº“å°±ç»ªï¼ˆçº¦10-20ç§’ï¼‰
sleep 15

# 5. éªŒè¯æ•°æ®åº“çŠ¶æ€
docker-compose ps
# æœŸæœ›çœ‹åˆ°: sage-postgres-1 çŠ¶æ€ä¸º "Up"
```

### ç¬¬ä¸‰æ­¥ï¼šå¯åŠ¨ Sage MCP æœåŠ¡å™¨

```bash
# 1. ç¡®ä¿åœ¨ Sage ç›®å½•ä¸‹
pwd
# åº”è¯¥æ˜¾ç¤º: /Users/jet/sage

# 2. æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
cat .env | grep SILICONFLOW_API_KEY
# ç¡®ä¿å·²è®¾ç½® API Key

# 3. å¯åŠ¨ MCP æœåŠ¡å™¨
python3 app/sage_mcp_server.py
```

**æœŸæœ›çœ‹åˆ°çš„å¯åŠ¨æ—¥å¿—ï¼š**
```
2025-01-13 15:30:00,000 - ConfigManager - INFO - é…ç½®å·²åŠ è½½
2025-01-13 15:30:00,100 - Database connected - Total memories: 82
INFO:     Started server process [12345]
INFO:     Uvicorn running on http://0.0.0.0:17800
```

### ç¬¬å››æ­¥ï¼šéªŒè¯æœåŠ¡çŠ¶æ€

æ‰“å¼€æ–°çš„ç»ˆç«¯çª—å£ï¼š

```bash
# 1. æ£€æŸ¥å¥åº·çŠ¶æ€
curl http://localhost:17800/health

# æœŸæœ›è¾“å‡º:
{
  "status": "healthy",
  "timestamp": "2025-01-13T15:30:30.000000",
  "memory_count": 82,
  "database": "connected"
}

# 2. æ£€æŸ¥ MCP å·¥å…·
curl -X POST http://localhost:17800/mcp \
  -H "Content-Type: application/json" \
  -d '{"jsonrpc":"2.0","id":"test","method":"tools/list","params":{}}'

# åº”è¯¥çœ‹åˆ° 4 ä¸ªå·¥å…·: save_conversation, get_context, search_memory, get_memory_stats
```

### ç¬¬äº”æ­¥ï¼šé…ç½® Claude Code

```bash
# 1. æŸ¥çœ‹å½“å‰ MCP é…ç½®
claude mcp list

# 2. å¦‚æœæ²¡æœ‰ sageï¼Œæ·»åŠ å®ƒ
claude mcp add -t http sage http://localhost:17800/mcp

# 3. éªŒè¯æ·»åŠ æˆåŠŸ
claude mcp list
# åº”è¯¥çœ‹åˆ°: sage: http://localhost:17800/mcp (HTTP)
```

### ç¬¬å…­æ­¥ï¼šæµ‹è¯•è®°å¿†åŠŸèƒ½

åœ¨ Claude Code ä¸­æµ‹è¯•ï¼š

```bash
# 1. æ‰“å¼€ Claude Codeï¼ˆåœ¨ä»»æ„ç›®å½•ï¼‰
cd ~
claude

# 2. å‘é€æµ‹è¯•æ¶ˆæ¯
"è¯·ä½¿ç”¨ get_memory_stats å·¥å…·æŸ¥çœ‹è®°å¿†ç»Ÿè®¡"

# 3. éªŒè¯è‡ªåŠ¨ä¸Šä¸‹æ–‡æ³¨å…¥
"æ ¹æ®æˆ‘ä»¬ä¹‹å‰çš„è®¨è®ºï¼ŒSage MCP æœ‰å“ªäº›ä¸»è¦åŠŸèƒ½ï¼Ÿ"
# Claude åº”è¯¥èƒ½å¤ŸåŸºäºå†å²è®°å¿†å›ç­”
```

## ğŸ” æ•…éšœæ’é™¤

### é—®é¢˜1ï¼šDocker æœªå¯åŠ¨

**ç—‡çŠ¶ï¼š** `docker ps` æŠ¥é”™ "Cannot connect to the Docker daemon"

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# macOS
open -a Docker

# Linux
sudo systemctl start docker
sudo systemctl enable docker
```

### é—®é¢˜2ï¼šæ•°æ®åº“è¿æ¥å¤±è´¥

**ç—‡çŠ¶ï¼š** MCP æœåŠ¡å™¨å¯åŠ¨æ—¶æŠ¥æ•°æ®åº“è¿æ¥é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# 1. æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker-compose ps

# 2. æŸ¥çœ‹æ•°æ®åº“æ—¥å¿—
docker-compose logs postgres

# 3. é‡å¯æ•°æ®åº“
docker-compose down
docker-compose up -d postgres
```

### é—®é¢˜3ï¼šç«¯å£è¢«å ç”¨

**ç—‡çŠ¶ï¼š** "Address already in use" é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# 1. æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :17800

# 2. ç»“æŸè¿›ç¨‹ï¼ˆå‡è®¾ PID æ˜¯ 12345ï¼‰
kill -9 12345

# 3. æˆ–ä¿®æ”¹ç«¯å£ï¼ˆåœ¨ .env æ–‡ä»¶ä¸­ï¼‰
SAGE_PORT=17801
```

### é—®é¢˜4ï¼šAPI Key é”™è¯¯

**ç—‡çŠ¶ï¼š** åµŒå…¥ç”Ÿæˆå¤±è´¥ï¼Œè¿”å› 401 é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# 1. æ£€æŸ¥ API Key
echo $SILICONFLOW_API_KEY

# 2. å¦‚æœä¸ºç©ºï¼Œè®¾ç½®å®ƒ
export SILICONFLOW_API_KEY="sk-your-actual-key"

# 3. æˆ–åœ¨ .env æ–‡ä»¶ä¸­è®¾ç½®
echo 'SILICONFLOW_API_KEY=sk-your-actual-key' >> .env
```

## ğŸ“Š ç³»ç»Ÿç›‘æ§

### å®æ—¶æ—¥å¿—æŸ¥çœ‹

```bash
# åœ¨ MCP æœåŠ¡å™¨è¿è¡Œçš„ç»ˆç«¯ä¸­å¯ä»¥çœ‹åˆ°å®æ—¶æ—¥å¿—

# æˆ–æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶ï¼ˆå¦‚æœé…ç½®äº†ï¼‰
tail -f logs/sage_mcp.log
```

### æ€§èƒ½ç›‘æ§

```bash
# 1. æŸ¥çœ‹å†…å­˜ä½¿ç”¨
ps aux | grep sage_mcp_server

# 2. æŸ¥çœ‹æ•°æ®åº“è¿æ¥
docker exec sage-postgres-1 psql -U sage_user -d sage_memory -c "SELECT count(*) FROM pg_stat_activity;"

# 3. æŸ¥çœ‹è®°å¿†æ•°é‡å¢é•¿
curl -s http://localhost:17800/health | jq '.memory_count'
```

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

### 1. åˆ›å»ºå¯åŠ¨è„šæœ¬

åˆ›å»º `start_sage.sh`ï¼š
```bash
#!/bin/bash
echo "å¯åŠ¨ Sage MCP ç³»ç»Ÿ..."

# å¯åŠ¨ Docker
if ! docker ps &> /dev/null; then
    echo "å¯åŠ¨ Docker..."
    open -a Docker  # macOS
    sleep 10
fi

# å¯åŠ¨æ•°æ®åº“
echo "å¯åŠ¨æ•°æ®åº“..."
cd "/Users/jet/sage"
docker-compose up -d postgres
sleep 10

# å¯åŠ¨ MCP æœåŠ¡å™¨
echo "å¯åŠ¨ MCP æœåŠ¡å™¨..."
python3 app/sage_mcp_server.py
```

### 2. è®¾ç½®å‘½ä»¤åˆ«å

åœ¨ `~/.zshrc` æˆ– `~/.bashrc` ä¸­æ·»åŠ ï¼š
```bash
alias sage-start='cd "/Users/jet/sage" && ./start_sage.sh'
alias sage-status='curl -s http://localhost:17800/health | jq'
alias sage-logs='docker-compose logs -f'
```

### 3. æ—¥å¸¸ä½¿ç”¨æµç¨‹

```bash
# æ—©ä¸Šå¼€å§‹å·¥ä½œ
sage-start

# æ£€æŸ¥çŠ¶æ€
sage-status

# ä½¿ç”¨ Claude Codeï¼ˆè‡ªåŠ¨å¸¦è®°å¿†ï¼‰
cd /path/to/any/project
claude

# æ™šä¸Šç»“æŸå·¥ä½œï¼ˆå¯é€‰ï¼Œä¿æŒè¿è¡Œä¹Ÿæ²¡é—®é¢˜ï¼‰
# Ctrl+C åœæ­¢ MCP æœåŠ¡å™¨
# docker-compose down
```

## ğŸ›¡ï¸ å®‰å…¨å»ºè®®

1. **API Key ä¿æŠ¤**
   - ä¸è¦å°† `.env` æ–‡ä»¶æäº¤åˆ° Git
   - å®šæœŸæ›´æ¢ API Key
   - ä½¿ç”¨ç¯å¢ƒå˜é‡è€Œéç¡¬ç¼–ç 

2. **æ•°æ®å®‰å…¨**
   - å®šæœŸå¤‡ä»½æ•°æ®åº“
   - å¯¹æ•æ„Ÿå¯¹è¯ä½¿ç”¨ `--no-memory` é€‰é¡¹
   - è€ƒè™‘åŠ å¯†æ•°æ®åº“å­˜å‚¨

3. **è®¿é—®æ§åˆ¶**
   - MCP æœåŠ¡å™¨ä»…ç›‘å¬æœ¬åœ°åœ°å€
   - ä¸è¦æš´éœ²åˆ°å…¬ç½‘
   - ä½¿ç”¨é˜²ç«å¢™è§„åˆ™ä¿æŠ¤ç«¯å£

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–

### å¿«é€Ÿå¯åŠ¨ä¼˜åŒ–
```bash
# é¢„ç¼–è¯‘ Python ä»£ç 
python3 -m compileall /Users/jet/sage/

# ä½¿ç”¨ Python ä¼˜åŒ–æ¨¡å¼
python3 -O app/sage_mcp_server.py
```

### å†…å­˜ä¼˜åŒ–
```bash
# åœ¨ .env ä¸­è°ƒæ•´ç¼“å­˜å¤§å°
SAGE_CACHE_SIZE=1000  # å¢åŠ ç¼“å­˜
SAGE_CACHE_TTL=600    # å»¶é•¿ç¼“å­˜æ—¶é—´
```

## ğŸ¯ å¿«é€Ÿæ£€æŸ¥æ¸…å•

å¯åŠ¨åç¡®è®¤ä»¥ä¸‹äº‹é¡¹ï¼š

- [ ] Docker æ­£åœ¨è¿è¡Œ
- [ ] PostgreSQL å®¹å™¨çŠ¶æ€ä¸º "Up"
- [ ] MCP æœåŠ¡å™¨åœ¨ 17800 ç«¯å£ç›‘å¬
- [ ] å¥åº·æ£€æŸ¥è¿”å› "healthy"
- [ ] Claude Code ä¸­å·²æ³¨å†Œ sage æœåŠ¡å™¨
- [ ] èƒ½å¤ŸæˆåŠŸè°ƒç”¨è®°å¿†å·¥å…·
- [ ] è‡ªåŠ¨ä¸Šä¸‹æ–‡æ³¨å…¥å·¥ä½œæ­£å¸¸

## ğŸ“ è·å–å¸®åŠ©

å¦‚æœé‡åˆ°é—®é¢˜ï¼š

1. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
2. å‚è€ƒæ•…éšœæ’é™¤ç« èŠ‚
3. æ£€æŸ¥ GitHub Issues
4. æäº¤æ–°çš„ Issue

---

**ç¥æ‚¨ä½¿ç”¨æ„‰å¿«ï¼** ğŸ‰

Sage MCP è®© Claude æ‹¥æœ‰æŒä¹…è®°å¿†ï¼Œè®©æ¯æ¬¡å¯¹è¯éƒ½æ›´æœ‰ä»·å€¼ã€‚