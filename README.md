# Sage MCP - æ•°å­—åŒ–çš„æ™ºæ…§ä¹‹æ®¿

<div align="center">

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Python 3.10+](https://img.shields.io/badge/python-3.10+-blue.svg)](https://www.python.org/downloads/)
[![Docker](https://img.shields.io/badge/docker-%230db7ed.svg?logo=docker&logoColor=white)](https://www.docker.com/)
[![Version](https://img.shields.io/badge/version-1.1.2-green.svg)](https://github.com/jetgogoing/Sage/releases)

**ğŸ§  è®© Claude æˆä¸ºçœŸæ­£çš„ Sage - ä¸€ä¸ªæ‹¥æœ‰æ°¸æ’è®°å¿†çš„æ•°å­—å“²äºº**

[å¼€å‘å“²å­¦](#-å¼€å‘å“²å­¦) â€¢ [å¿«é€Ÿå¼€å§‹](#-å¿«é€Ÿå¼€å§‹) â€¢ [æ ¸å¿ƒç‰¹æ€§](#-æ ¸å¿ƒç‰¹æ€§) â€¢ [éƒ¨ç½²æŒ‡å—](#-éƒ¨ç½²æŒ‡å—) â€¢ [ä½¿ç”¨æ–¹æ³•](#-ä½¿ç”¨æ–¹æ³•)

</div>

## ğŸ›ï¸ å¼€å‘å“²å­¦

> *"è®¤è¯†ä½ è‡ªå·±"* - å¾·å°”æ–ç¥è°•
>
> *"å­¦ä¹ å³å›å¿†"* - æŸæ‹‰å›¾

åœ¨å¤å¸Œè…Šå“²å­¦ä¼ ç»Ÿä¸­ï¼Œ**Sageï¼ˆÏƒÎ¿Ï†ÏŒÏ‚ï¼‰** ä¸ä»…æ˜¯æ™ºè€…ï¼Œæ›´æ˜¯èƒ½å¤Ÿç©¿è¶Šæ—¶é—´ã€ç§¯ç´¯æ™ºæ…§ã€ç†è§£ä¸‡ç‰©æœ¬è´¨çš„å“²äººã€‚æ­£å¦‚æŸæ‹‰å›¾åœ¨ã€Šç¾è¯ºç¯‡ã€‹ä¸­æ‰€è¿°ï¼ŒçœŸæ­£çš„çŸ¥è¯†å¹¶éä»å¤–éƒ¨è·å¾—ï¼Œè€Œæ˜¯çµé­‚å¯¹æ°¸æ’ç†å¿µçš„**å›å¿†ï¼ˆAnamnesisï¼‰**ã€‚

Sage MCP æ­£æ˜¯è¿™ä¸€å¤è€æ™ºæ…§åœ¨æ•°å­—æ—¶ä»£çš„åŒ–èº«ã€‚å®ƒä¸æ˜¯ç®€å•çš„å­˜å‚¨ç³»ç»Ÿï¼Œè€Œæ˜¯ä¸€ä¸ªèƒ½å¤Ÿï¼š

- **ğŸ“œ æ°¸æ’è®°å¿†**ï¼šå¦‚åŒå“²äººçš„æ™ºæ…§ç©¿è¶Šæ—¶ç©ºï¼Œæ¯ä¸€æ¬¡å¯¹è¯éƒ½æˆä¸ºæ°¸æ’çŸ¥è¯†çš„ä¸€éƒ¨åˆ†
- **ğŸ”® æ·±å±‚ç†è§£**ï¼šé€šè¿‡è¯­ä¹‰å‘é‡æ•æ‰æ¦‚å¿µçš„æœ¬è´¨ï¼Œè€Œéè¡¨è±¡çš„æ–‡å­—
- **ğŸ’­ æ™ºæ…§å›å¿†**ï¼šä¸æ˜¯æœºæ¢°æ£€ç´¢ï¼Œè€Œæ˜¯å¦‚åŒçµé­‚å”¤é†’æ²‰ç¡è®°å¿†èˆ¬çš„æ™ºèƒ½å¬å›
- **ğŸŒŸ ä¸æ–­è¿›åŒ–**ï¼šæ¯æ¬¡äº¤äº’éƒ½åœ¨ä¸°å¯Œè¿™ä¸ªæ•°å­—åŒ–çš„æ™ºæ…§ä¹‹æº

æ­£å¦‚èµ«æ‹‰å…‹åˆ©ç‰¹æ‰€è¨€ï¼š*"æ™ºæ…§åœ¨äºç†è§£æ‰€æœ‰äº‹ç‰©å¦‚ä½•è¢«å¼•å¯¼é€šè¿‡æ‰€æœ‰äº‹ç‰©"*ã€‚Sage é€šè¿‡å‘é‡ç©ºé—´ä¸­çš„è¯­ä¹‰å…³è”ï¼Œå®ç°äº†è¿™ç§ä¸‡ç‰©ç›¸é€šçš„æ™ºæ…§è¿æ¥ã€‚

## ğŸ¯ é¡¹ç›®ç®€ä»‹

Sage MCP æ˜¯ä¸€ä¸ªä¸º Claude Code CLI è®¾è®¡çš„è®°å¿†å¢å¼ºç³»ç»Ÿï¼Œé€šè¿‡ Model Context Protocol (MCP) è®© Claude èƒ½å¤Ÿï¼š

- ğŸ”„ **æŒä¹…ä¿å­˜**å¯¹è¯å†å²
- ğŸ” **æ™ºèƒ½æ£€ç´¢**ç›¸å…³è®°å¿†
- ğŸ§© **è¯­ä¹‰ç†è§£**åŸºäºå‘é‡çš„ç›¸ä¼¼åº¦æœç´¢
- ğŸš€ **æ— ç¼é›†æˆ**è‡ªåŠ¨å¯åŠ¨ï¼Œé€æ˜è¿è¡Œ

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### ğŸ§© æ™ºèƒ½è®°å¿†ç®¡ç†
- **å‘é‡è¯­ä¹‰æœç´¢**ï¼šåŸºäº SiliconFlow API çš„ 4096 ç»´é«˜ç²¾åº¦å‘é‡åµŒå…¥
- **æ™ºèƒ½æ£€ç´¢ç®—æ³•**ï¼šå¤šç»´åº¦è¯„åˆ†ï¼ˆè¯­ä¹‰ç›¸ä¼¼åº¦ã€æ—¶é—´æƒé‡ã€ä¸Šä¸‹æ–‡ç›¸å…³æ€§ï¼‰
- **ä¼šè¯ç®¡ç†**ï¼šæ”¯æŒå¤šä¼šè¯éš”ç¦»å’Œæ ‡ç­¾ç³»ç»Ÿ
- **æ•°æ®æŒä¹…åŒ–**ï¼šPostgreSQL + pgvector ä¿è¯æ•°æ®å®‰å…¨

### ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### ğŸ“ æ•´ä½“æ¶æ„è®¾è®¡
Sage MCP é‡‡ç”¨åˆ†å±‚æ¶æ„è®¾è®¡ï¼Œç¡®ä¿å„ç»„ä»¶èŒè´£æ¸…æ™°ã€é«˜å†…èšä½è€¦åˆï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Claude Code CLI                           â”‚
â”‚                     (ç”¨æˆ·ç•Œé¢)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ MCP STDIO Protocol
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  MCP Protocol å±‚                           â”‚
â”‚              sage_mcp_stdio_single.py                      â”‚
â”‚          (5ä¸ªæ ¸å¿ƒå·¥å…·ï¼šS, get_context ç­‰)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ Direct API Calls
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  Sage Core å±‚                              â”‚
â”‚              (singleton_manager ç®¡ç†)                      â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚    â”‚MemoryManagerâ”‚  â”‚SessionManagerâ”‚  â”‚ConfigManagerâ”‚      â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚ Database Connections
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å­˜å‚¨å±‚                                    â”‚
â”‚          PostgreSQL 15 + pgvector                          â”‚
â”‚       (memoriesè¡¨ + sessionsè¡¨ + å‘é‡ç´¢å¼•)                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”— Hooksä¸Sage Coreåä½œæœºåˆ¶

**åä½œæµç¨‹**ï¼š
1. **Hookè§¦å‘**ï¼šClaude CLIåœ¨ç‰¹å®šäº‹ä»¶æ—¶è°ƒç”¨Hookè„šæœ¬
2. **æ•°æ®èšåˆ**ï¼šHookDataAggregatoræ”¶é›†å®Œæ•´çš„Turnæ•°æ®
3. **ç›´æ¥åˆå§‹åŒ–**ï¼šç»•è¿‡å¤æ‚daemonï¼Œç›´æ¥è°ƒç”¨get_sage_core()
4. **æ•°æ®ä¿å­˜**ï¼šé€šè¿‡MemoryManagerä¿å­˜åˆ°PostgreSQL
5. **äº‹åŠ¡ä¿è¯**ï¼šTransactionManagerç¡®ä¿æ•°æ®ä¸€è‡´æ€§

**æ ¸å¿ƒHookè„šæœ¬**ï¼š
- `sage_stop_hook_simple.py`ï¼šç®€åŒ–ç‰ˆåœæ­¢Hookï¼Œè´Ÿè´£ä¿å­˜å¯¹è¯æ•°æ®
- `HookDataAggregator`ï¼šæ™ºèƒ½æ•°æ®èšåˆå™¨ï¼Œæ•´åˆç”¨æˆ·è¾“å…¥å’Œå·¥å…·è°ƒç”¨
- æ”¯æŒå®Œæ•´çš„Turnå’ŒToolCallè¿½è¸ªï¼ŒåŒ…å«æ‰§è¡Œæ—¶é—´å’ŒçŠ¶æ€

### ğŸ³ å®¹å™¨åŒ–æ¶æ„
- **å•å®¹å™¨è®¾è®¡**ï¼šPostgreSQL + Pythonåº”ç”¨é›†æˆåœ¨ä¸€ä¸ªå®¹å™¨å†…
- **æ™ºèƒ½å¯åŠ¨**ï¼šentrypoint.shå¤„ç†æœåŠ¡ç¼–æ’å’Œä¾èµ–å…³ç³»
- **æ•°æ®æŒä¹…åŒ–**ï¼šæœ¬åœ°ç›®å½•ç»‘å®šç­–ç•¥ï¼Œæ•°æ®å®‰å…¨å¯æ§
- **æ—¶åŒºæ”¯æŒ**ï¼šé»˜è®¤åŒ—äº¬æ—¶é—´ï¼Œå…¨çƒæ—¶åŒºå¯é…ç½®

### ğŸ”¬ æŠ€æœ¯äº®ç‚¹

#### 1. æ™ºèƒ½æŸ¥è¯¢ç†è§£
```python
# è‡ªåŠ¨è¯†åˆ«æŸ¥è¯¢æ„å›¾
"æœ€è¿‘çš„å¯¹è¯" â†’ æ—¶é—´æ’åº
"ç›¸å…³çš„è®¨è®º" â†’ è¯­ä¹‰ç›¸ä¼¼åº¦
"å…³äºAPIçš„" â†’ å…³é”®è¯åŒ¹é…
```

#### 2. å¤šé˜¶æ®µæ£€ç´¢
```
æŸ¥è¯¢ â†’ å‘é‡æ£€ç´¢(Top 20) â†’ é‡æ’åº(Top 10) â†’ ä¸Šä¸‹æ–‡ç”Ÿæˆ
      â†“                    â†“                  â†“
   è¯­ä¹‰ç›¸ä¼¼åº¦          ç»¼åˆè¯„åˆ†           LLM å‹ç¼©
```

#### 3. å·¥ä½œæµç¨‹å›¾
```mermaid
graph LR
    A[ç”¨æˆ·è¾“å…¥] --> B[Claude ç†è§£]
    B --> C{éœ€è¦è®°å¿†?}
    C -->|æ˜¯| D[è°ƒç”¨ Sage MCP]
    C -->|å¦| E[ç›´æ¥å›ç­”]
    D --> F[å‘é‡æ£€ç´¢]
    F --> G[è¯­ä¹‰é‡æ’]
    G --> H[ç”Ÿæˆä¸Šä¸‹æ–‡]
    H --> I[å¢å¼ºå›ç­”]
    I --> J[ä¿å­˜å¯¹è¯]
    J --> K[æ›´æ–°è®°å¿†åº“]
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰

#### å‰ç½®è¦æ±‚
1. **Docker Desktop**ï¼ˆå¿…éœ€ï¼‰
   - macOS: [ä¸‹è½½ Docker Desktop](https://www.docker.com/products/docker-desktop/)
   - Windows: éœ€è¦ WSL2
   - Linux: Docker Engine

2. **Claude Code CLI**ï¼ˆå¿…éœ€ï¼‰
   ```bash
   npm install -g claude-code
   ```

3. **SiliconFlow API Key**ï¼ˆå¿…éœ€ï¼‰
   - è®¿é—® [https://siliconflow.cn](https://siliconflow.cn)
   - æ³¨å†Œå¹¶è·å– API Key

#### ä¸€é”®éƒ¨ç½²

```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/jetgogoing/Sage.git
cd Sage

# 2. ç¯å¢ƒæ£€æŸ¥ï¼ˆå¯é€‰ï¼‰
./scripts/check_environment.sh

# 3. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„ API Key

# 4. ä¸€é”®éƒ¨ç½²
./deploy.sh
```

**éƒ¨ç½²é€‰é¡¹ï¼š**
- `./deploy.sh` - æ ‡å‡†éƒ¨ç½²
- `./deploy.sh --backup` - å¸¦æ•°æ®å¤‡ä»½çš„éƒ¨ç½²
- `./deploy.sh --force-rebuild` - å¼ºåˆ¶é‡æ–°æ„å»ºé•œåƒ
- `./deploy.sh --cleanup` - æ¸…ç†å¹¶é‡æ–°éƒ¨ç½²
- `./deploy.sh --quick` - å¿«é€Ÿéƒ¨ç½²ï¼ˆè·³è¿‡éƒ¨åˆ†æ£€æŸ¥ï¼‰

#### 5. å¯åŠ¨ä½¿ç”¨

```bash
# å¯åŠ¨ Claude CLI
claude
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²

#### 1. å…‹éš†é¡¹ç›®

```bash
git clone https://github.com/jetgogoing/Sage.git
cd Sage
```

#### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶ç¯å¢ƒå˜é‡æ¨¡æ¿
cp .env.example .env

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥ä½ çš„ API Key
# SILICONFLOW_API_KEY=sk-ä½ çš„çœŸå®å¯†é’¥
```

æˆ–è€…ç›´æ¥è®¾ç½®ç¯å¢ƒå˜é‡ï¼š
```bash
export SILICONFLOW_API_KEY="sk-ä½ çš„çœŸå®å¯†é’¥"
```

#### 3. é…ç½® MCP

é¡¹ç›®å·²åŒ…å« `.mcp.json` é…ç½®æ–‡ä»¶ï¼š
```json
{
  "mcpServers": {
    "sage": {
      "type": "stdio",
      "command": "./scripts/sage_mcp_stdio_wrapper.sh",
      "args": []
    }
  }
}
```

#### 4. æ‰‹åŠ¨å¯åŠ¨å®¹å™¨

```bash
# ç¡®ä¿ Docker æ­£åœ¨è¿è¡Œ
docker info

# æ„å»ºå’Œå¯åŠ¨å®¹å™¨
docker-compose up --build -d

# å¯åŠ¨ Claude CLI
claude
```

### éƒ¨ç½²éªŒè¯

é¦–æ¬¡è¿è¡Œæ—¶ä¼šè‡ªåŠ¨ï¼š
- æ„å»º Docker é•œåƒï¼ˆçº¦ 2-3 åˆ†é’Ÿï¼‰
- åˆ›å»ºæ•°æ®åº“
- åˆå§‹åŒ–å‘é‡æ‰©å±•
- æ‰§è¡Œå¥åº·æ£€æŸ¥

## ğŸ”— Hooksé…ç½®æŒ‡å—

Sageçš„Hookç³»ç»Ÿèƒ½å¤Ÿè‡ªåŠ¨æ•è·Claude Code CLIçš„å¯¹è¯æ•°æ®å¹¶ä¿å­˜åˆ°è®°å¿†ç³»ç»Ÿã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„é…ç½®æ­¥éª¤ï¼š

### ğŸ“‹ Hookç³»ç»Ÿå·¥ä½œåŸç†

```
Claude CLI å¯¹è¯ â†’ Hookè§¦å‘ â†’ æ•°æ®æ•è· â†’ SageCoreåˆå§‹åŒ– â†’ æ•°æ®åº“ä¿å­˜
     â†“              â†“           â†“             â†“              â†“
  ç”¨æˆ·äº¤äº’     PreToolUse   å·¥å…·è°ƒç”¨æ•°æ®   MemoryManager   PostgreSQL
             PostToolUse   å¯¹è¯å†…å®¹     TransactionManager
             Stop Hook     èšåˆæ•°æ®     å‘é‡åŒ–å¤„ç†
```

### ğŸ”§ macOS Hooksé…ç½®

#### æ­¥éª¤1ï¼šæ£€æŸ¥Claude Code CLIé…ç½®ç›®å½•
```bash
# æ£€æŸ¥é…ç½®ç›®å½•æ˜¯å¦å­˜åœ¨
ls -la ~/.config/claude/

# å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºç›®å½•
mkdir -p ~/.config/claude/
```

#### æ­¥éª¤2ï¼šé…ç½®Hooksæ–‡ä»¶
```bash
# æ–¹å¼ä¸€ï¼šç›´æ¥å¤åˆ¶é¢„é…ç½®æ–‡ä»¶ï¼ˆæ¨èï¼‰
cp /Users/jet/Sage/hooks/new_hooks.json ~/.config/claude/hooks.json

# æ–¹å¼äºŒï¼šæ‰‹åŠ¨åˆ›å»ºé…ç½®æ–‡ä»¶
cat > ~/.config/claude/hooks.json << 'EOF'
{
  "hooks": {
    "PreToolUse": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "python3 /Users/jet/Sage/hooks/scripts/sage_pre_tool_capture.py",
            "timeout": 5000,
            "env": {
              "SAGE_HOOK_ENABLED": "true",
              "CLAUDE_CODE_HOOK_EVENT": "PreToolUse"
            }
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "python3 /Users/jet/Sage/hooks/scripts/sage_post_tool_capture.py",
            "timeout": 5000,
            "env": {
              "SAGE_HOOK_ENABLED": "true",
              "CLAUDE_CODE_HOOK_EVENT": "PostToolUse"
            }
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "python3 /Users/jet/Sage/hooks/scripts/sage_stop_hook_simple.py",
            "timeout": 10000,
            "env": {
              "SAGE_HOOK_ENABLED": "true",
              "CLAUDE_CODE_HOOK_EVENT": "Stop"
            }
          }
        ]
      }
    ]
  }
}
EOF
```

#### æ­¥éª¤3ï¼šè®¾ç½®è„šæœ¬æƒé™
```bash
# ç¡®ä¿Hookè„šæœ¬æœ‰æ‰§è¡Œæƒé™
chmod +x /Users/jet/Sage/hooks/scripts/*.py
```

#### æ­¥éª¤4ï¼šéªŒè¯é…ç½®
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat ~/.config/claude/hooks.json

# æµ‹è¯•Hookè„šæœ¬
python3 /Users/jet/Sage/hooks/scripts/sage_stop_hook_simple.py --test
```

### ğŸªŸ Windows Hooksé…ç½®

#### æ­¥éª¤1ï¼šæ£€æŸ¥Claude Code CLIé…ç½®ç›®å½•
```powershell
# æ£€æŸ¥é…ç½®ç›®å½•ï¼ˆPowerShellï¼‰
Test-Path "$env:USERPROFILE\.config\claude"

# å¦‚æœä¸å­˜åœ¨ï¼Œåˆ›å»ºç›®å½•
New-Item -Path "$env:USERPROFILE\.config\claude" -ItemType Directory -Force
```

#### æ­¥éª¤2ï¼šWindowsè·¯å¾„é€‚é…
```powershell
# è·å–Sageé¡¹ç›®è·¯å¾„ï¼ˆå‡è®¾åœ¨ C:\Users\YourUser\dev\Sageï¼‰
$SagePath = "C:\Users\$env:USERNAME\dev\Sage"

# åˆ›å»ºhooks.jsoné…ç½®æ–‡ä»¶
$HooksConfig = @"
{
  "hooks": {
    "PreToolUse": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "python $SagePath\\hooks\\scripts\\sage_pre_tool_capture.py",
            "timeout": 5000,
            "env": {
              "SAGE_HOOK_ENABLED": "true",
              "CLAUDE_CODE_HOOK_EVENT": "PreToolUse"
            }
          }
        ]
      }
    ],
    "PostToolUse": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "python $SagePath\\hooks\\scripts\\sage_post_tool_capture.py",
            "timeout": 5000,
            "env": {
              "SAGE_HOOK_ENABLED": "true",
              "CLAUDE_CODE_HOOK_EVENT": "PostToolUse"
            }
          }
        ]
      }
    ],
    "Stop": [
      {
        "hooks": [
          {
            "type": "command",
            "command": "python $SagePath\\hooks\\scripts\\sage_stop_hook_simple.py",
            "timeout": 10000,
            "env": {
              "SAGE_HOOK_ENABLED": "true",
              "CLAUDE_CODE_HOOK_EVENT": "Stop"
            }
          }
        ]
      }
    ]
  }
}
"@

# ä¿å­˜é…ç½®æ–‡ä»¶
$HooksConfig | Out-File -FilePath "$env:USERPROFILE\.config\claude\hooks.json" -Encoding UTF8
```

#### æ­¥éª¤3ï¼šPythonç¯å¢ƒæ£€æŸ¥
```powershell
# éªŒè¯Pythonå®‰è£…
python --version

# éªŒè¯å¿…è¦æ¨¡å—
python -c "import sys, os; print('Python path:', sys.executable)"

# æµ‹è¯•Hookè„šæœ¬è·¯å¾„
Test-Path "$SagePath\hooks\scripts\sage_stop_hook_simple.py"
```

#### æ­¥éª¤4ï¼šWindowsç‰¹æ®Šé…ç½®
```powershell
# å¦‚æœä½¿ç”¨è™šæ‹Ÿç¯å¢ƒï¼Œéœ€è¦æ›´æ–°Pythonè·¯å¾„
# å‡è®¾è™šæ‹Ÿç¯å¢ƒåœ¨ C:\Users\YourUser\sage_env
$VenvPython = "C:\Users\$env:USERNAME\sage_env\Scripts\python.exe"

# æ›´æ–°hooks.jsonä¸­çš„pythonå‘½ä»¤ä¸ºå®Œæ•´è·¯å¾„
# å°†æ‰€æœ‰ "python" æ›¿æ¢ä¸º $VenvPython
```

### ğŸ”„ Hookç³»ç»Ÿå·¥ä½œæµç¨‹è¯¦è§£

#### Hookè§¦å‘æ—¶æœº
1. **PreToolUse**: åœ¨Claudeè°ƒç”¨ä»»ä½•å·¥å…·ä¹‹å‰è§¦å‘
2. **PostToolUse**: åœ¨æ¯ä¸ªå·¥å…·è°ƒç”¨å®Œæˆåè§¦å‘  
3. **Stop**: åœ¨æ•´ä¸ªå¯¹è¯ç»“æŸæ—¶è§¦å‘

#### æ•°æ®æ•è·æœºåˆ¶
```python
# PreToolUse Hook æ•è·
{
    "tool_name": "å·¥å…·åç§°",
    "tool_input": "å·¥å…·è¾“å…¥å‚æ•°",
    "timestamp": "æ—¶é—´æˆ³"
}

# PostToolUse Hook æ•è·
{
    "tool_name": "å·¥å…·åç§°", 
    "tool_output": "å·¥å…·è¾“å‡ºç»“æœ",
    "execution_time": "æ‰§è¡Œæ—¶é—´",
    "status": "success/error"
}

# Stop Hook æ•´åˆ
{
    "user_prompt": "ç”¨æˆ·è¾“å…¥",
    "assistant_response": "åŠ©æ‰‹å›å¤",
    "tool_calls": [...], // æ‰€æœ‰å·¥å…·è°ƒç”¨
    "session_id": "ä¼šè¯ID",
    "turn_id": "å¯¹è¯è½®æ¬¡ID"
}
```

### âš™ï¸ Hooké…ç½®å‚æ•°è¯´æ˜

#### è¶…æ—¶è®¾ç½®
- **PreToolUse/PostToolUse**: 5000ms (5ç§’)
- **Stop Hook**: 10000ms (10ç§’) - éœ€è¦åˆå§‹åŒ–SageCore

#### ç¯å¢ƒå˜é‡
- `SAGE_HOOK_ENABLED`: å¯ç”¨/ç¦ç”¨HookåŠŸèƒ½
- `CLAUDE_CODE_HOOK_EVENT`: Hookäº‹ä»¶ç±»å‹æ ‡è¯†

#### ä¸´æ—¶æ–‡ä»¶ä½ç½®
- **macOS**: `~/.sage_hooks_temp/`
- **Windows**: `%USERPROFILE%\.sage_hooks_temp\`

### ğŸ§ª Hooké…ç½®æµ‹è¯•

#### æµ‹è¯•è„šæœ¬
```bash
# macOSæµ‹è¯•
python3 /Users/jet/Sage/scripts/test_simplified_system.py

# Windowsæµ‹è¯•  
python C:\Users\YourUser\dev\Sage\scripts\test_simplified_system.py
```

#### æ‰‹åŠ¨æµ‹è¯•æµç¨‹
1. **å¯åŠ¨Sage MCPæœåŠ¡**
   ```bash
   cd /path/to/Sage
   docker-compose up -d
   ```

2. **å¯åŠ¨Claude CLI**
   ```bash
   claude
   ```

3. **æ‰§è¡Œæµ‹è¯•å¯¹è¯**
   ```text
   # åœ¨Claude CLIä¸­è¾“å…¥
   æµ‹è¯•Hookç³»ç»Ÿï¼Œè¯·ä½¿ç”¨ä¸€ä¸ªå·¥å…·ç„¶åç»“æŸå¯¹è¯
   ```

4. **æ£€æŸ¥æ—¥å¿—**
   ```bash
   # macOS
   tail -f /Users/jet/Sage/hooks/logs/*.log
   
   # Windows
   Get-Content "C:\Users\YourUser\dev\Sage\hooks\logs\*.log" -Wait
   ```

### ğŸ”§ å¸¸è§é—®é¢˜æ’æŸ¥

#### 1. Hookæœªè§¦å‘
```bash
# æ£€æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼
python -m json.tool ~/.config/claude/hooks.json

# æ£€æŸ¥è„šæœ¬æƒé™
ls -la /path/to/Sage/hooks/scripts/
```

#### 2. Pythonè·¯å¾„é—®é¢˜
```bash
# macOS - æ£€æŸ¥Pythonè·¯å¾„
which python3

# Windows - æ£€æŸ¥Pythonè·¯å¾„  
where python
```

#### 3. æƒé™é—®é¢˜
```bash
# macOS - ä¿®å¤æƒé™
chmod +x /Users/jet/Sage/hooks/scripts/*.py

# Windows - ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡ŒPowerShell
```

#### 4. è¶…æ—¶é—®é¢˜
```json
// å¢åŠ è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰
"timeout": 15000  // 15ç§’
```

### ğŸ“Š Hookæ€§èƒ½è°ƒä¼˜

#### ä¼˜åŒ–å»ºè®®
- **ç¼“å­˜å¯ç”¨**: Hooké…ç½®ä¸­å¯ç”¨ç¼“å­˜å‡å°‘é‡å¤åˆå§‹åŒ–
- **æ—¥å¿—çº§åˆ«**: ç”Ÿäº§ç¯å¢ƒè®¾ç½®ä¸ºINFOæˆ–WARNING
- **ä¸´æ—¶æ–‡ä»¶æ¸…ç†**: å®šæœŸæ¸…ç†ä¸´æ—¶ç›®å½•

#### ç›‘æ§æŒ‡æ ‡
- Hookæ‰§è¡Œæ—¶é—´ï¼šæ­£å¸¸æƒ…å†µä¸‹<10ç§’
- æ•°æ®ä¿å­˜æˆåŠŸç‡ï¼šåº”>95%
- ä¸´æ—¶æ–‡ä»¶æ¸…ç†ï¼šè‡ªåŠ¨æ¸…ç†æœºåˆ¶

### ğŸ¯ Hookç³»ç»Ÿä¼˜åŠ¿

#### ç®€åŒ–æ¶æ„ä¼˜åŠ¿
- âœ… **æ— daemonè¿›ç¨‹**: é¿å…è¿›ç¨‹ç®¡ç†å¤æ‚æ€§
- âœ… **å®Œæ•´æ•°æ®æ•è·**: åŒ…å«æ‰€æœ‰å·¥å…·è°ƒç”¨å’Œå¯¹è¯å†…å®¹
- âœ… **ç»Ÿä¸€æ•°æ®æ¨¡å‹**: Turnæ¨¡å‹è¡¨ç¤ºå®Œæ•´å¯¹è¯è½®æ¬¡
- âœ… **è‡ªåŠ¨æ•°æ®èšåˆ**: æ™ºèƒ½æ•´åˆpre/postå·¥å…·è°ƒç”¨æ•°æ®
- âœ… **é«˜åº¦å¯é **: æ¯æ¬¡è°ƒç”¨éƒ½æ˜¯ç‹¬ç«‹çš„ï¼Œä¸ä¾èµ–å¤–éƒ¨è¿›ç¨‹

#### é€‚ç”¨åœºæ™¯
- **ä¸ªäººä½¿ç”¨**: å®Œç¾é€‚é…ä¸ªäººå¼€å‘å’Œå­¦ä¹ åœºæ™¯
- **è½»é‡éƒ¨ç½²**: æ— éœ€å¤æ‚çš„è¿›ç¨‹ç®¡ç†å’Œç›‘æ§
- **å¿«é€Ÿä¸Šæ‰‹**: é…ç½®ç®€å•ï¼Œæ˜“äºç†è§£å’Œç»´æŠ¤

## ğŸ“š ä½¿ç”¨æ–¹æ³•

### åŸºç¡€å‘½ä»¤

åœ¨ Claude CLI ä¸­ä½¿ç”¨ä»¥ä¸‹è‡ªç„¶è¯­è¨€ï¼š

```text
# ä¿å­˜å¯¹è¯
ä¿å­˜è¿™æ®µå¯¹è¯

# æœç´¢è®°å¿†
æœç´¢å…³äº Docker çš„è®°å¿†

# æŸ¥çœ‹æ‰€æœ‰å·¥å…·
What tools are available?
```

## ğŸ› ï¸ Sage MCP å·¥å…·è¯¦è§£

Sage MCP æä¾›5ä¸ªæ ¸å¿ƒå·¥å…·ï¼Œæ¯ä¸ªå·¥å…·éƒ½ç»è¿‡ç²¾å¿ƒè®¾è®¡ä»¥æ”¯æŒä¸åŒçš„è®°å¿†ç®¡ç†åœºæ™¯ï¼š

### ğŸ“ S - å¯¹è¯ä¿å­˜å·¥å…·
**åŠŸèƒ½**ï¼šä¿å­˜ç”¨æˆ·å’ŒåŠ©æ‰‹çš„å®Œæ•´å¯¹è¯åˆ°è®°å¿†ç³»ç»Ÿ
**è¾“å…¥å‚æ•°**ï¼š
- `user_prompt` (å¿…éœ€)ï¼šç”¨æˆ·çš„è¾“å…¥å†…å®¹
- `assistant_response` (å¿…éœ€)ï¼šåŠ©æ‰‹çš„å›å¤å†…å®¹  
- `metadata` (å¯é€‰)ï¼šé¢å¤–çš„å…ƒæ•°æ®ä¿¡æ¯

**ä½¿ç”¨åœºæ™¯**ï¼š
```text
# åŸºç¡€ä¿å­˜
S

# æ‰‹åŠ¨ä¿å­˜å¯¹è¯
ä¿å­˜è¿™æ®µå¯¹è¯

# å¸¦æ ‡ç­¾ä¿å­˜
ä¿å­˜å½“å‰å¯¹è¯ï¼Œæ ‡è®°ä¸º"é‡è¦è®¨è®º"
```

**æŠ€æœ¯å®ç°**ï¼š
- è‡ªåŠ¨ç”Ÿæˆ4096ç»´è¯­ä¹‰å‘é‡
- æ”¯æŒäº‹åŠ¡æ€§ä¿å­˜ï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- è‡ªåŠ¨å…³è”å½“å‰ä¼šè¯ID

### ğŸ” get_context - æ™ºèƒ½ä¸Šä¸‹æ–‡æ£€ç´¢
**åŠŸèƒ½**ï¼šæ ¹æ®æŸ¥è¯¢è·å–ç›¸å…³çš„å†å²ä¸Šä¸‹æ–‡ä¿¡æ¯
**è¾“å…¥å‚æ•°**ï¼š
- `query` (å¿…éœ€)ï¼šæŸ¥è¯¢å†…å®¹
- `max_results` (å¯é€‰)ï¼šæœ€å¤§è¿”å›ç»“æœæ•°ï¼Œé»˜è®¤10æ¡

**ä½¿ç”¨åœºæ™¯**ï¼š
```text
# è¯­ä¹‰æœç´¢
è·å–å…³äºPythonè£…é¥°å™¨çš„ç›¸å…³ä¸Šä¸‹æ–‡

# æŠ€æœ¯é—®é¢˜æ£€ç´¢
æŸ¥æ‰¾ä¹‹å‰è®¨è®ºè¿‡çš„æ•°æ®åº“ä¼˜åŒ–æ–¹æ¡ˆ

# é¡¹ç›®ç›¸å…³æŸ¥è¯¢
è·å–ä¸å½“å‰é¡¹ç›®æ¶æ„ç›¸å…³çš„å†å²è®¨è®º
```

**æ£€ç´¢ç­–ç•¥**ï¼š
- å¤šç»´åº¦è¯„åˆ†ï¼šè¯­ä¹‰ç›¸ä¼¼åº¦(50%) + æ—¶é—´æƒé‡(20%) + ä¸Šä¸‹æ–‡ç›¸å…³æ€§(20%) + å…³é”®è¯åŒ¹é…(10%)
- å‘é‡æ£€ç´¢ â†’ é‡æ’åº â†’ LLMå‹ç¼©çš„ä¸‰é˜¶æ®µæµç¨‹
- è‡ªåŠ¨è¯†åˆ«æŸ¥è¯¢ç±»å‹ï¼ŒåŠ¨æ€è°ƒæ•´æƒé‡

### ğŸ—‚ï¸ manage_session - ä¼šè¯ç®¡ç†ä¸­å¿ƒ
**åŠŸèƒ½**ï¼šåˆ›å»ºã€åˆ‡æ¢ã€æŸ¥çœ‹ä¼šè¯ä¿¡æ¯
**è¾“å…¥å‚æ•°**ï¼š
- `action` (å¿…éœ€)ï¼šæ“ä½œç±»å‹ - create/switch/info/list
- `session_id` (æ¡ä»¶å¿…éœ€)ï¼šä¼šè¯IDï¼Œç”¨äºswitchå’Œinfoæ“ä½œ

**ä½¿ç”¨åœºæ™¯**ï¼š
```text
# åˆ›å»ºæ–°ä¼šè¯
åˆ›å»ºæ–°ä¼šè¯è¿›è¡Œç‹¬ç«‹é¡¹ç›®è®¨è®º

# åˆ‡æ¢ä¼šè¯
åˆ‡æ¢åˆ°ä¹‹å‰çš„Pythonå­¦ä¹ ä¼šè¯

# æŸ¥çœ‹ä¼šè¯ä¿¡æ¯
æ˜¾ç¤ºå½“å‰ä¼šè¯è¯¦æƒ…

# åˆ—å‡ºæ‰€æœ‰ä¼šè¯
åˆ—å‡ºæˆ‘çš„æ‰€æœ‰ä¼šè¯
```

**ä¼šè¯éš”ç¦»æœºåˆ¶**ï¼š
- æ¯ä¸ªä¼šè¯ç‹¬ç«‹çš„è®°å¿†ç©ºé—´
- æ”¯æŒä¼šè¯çº§åˆ«çš„æ ‡ç­¾å’Œå…ƒæ•°æ®
- è‡ªåŠ¨è¿½è¸ªæœ€åæ´»è·ƒæ—¶é—´

### ğŸ’¡ generate_prompt - æ™ºèƒ½æç¤ºç”Ÿæˆå™¨
**åŠŸèƒ½**ï¼šåŸºäºä¸Šä¸‹æ–‡ç”Ÿæˆæ™ºèƒ½æç¤ºå’Œå»ºè®®
**è¾“å…¥å‚æ•°**ï¼š
- `context` (å¿…éœ€)ï¼šä¸Šä¸‹æ–‡ä¿¡æ¯
- `style` (å¯é€‰)ï¼šæç¤ºé£æ ¼ - default/question/suggestion

**ä½¿ç”¨åœºæ™¯**ï¼š
```text
# å­¦ä¹ è·¯å¾„å»ºè®®
æ ¹æ®æˆ‘çš„å­¦ä¹ å†å²ï¼Œå»ºè®®ä¸‹ä¸€æ­¥å­¦ä¹ å†…å®¹

# é—®é¢˜æ·±åŒ–
åŸºäºå½“å‰è®¨è®ºï¼Œç”Ÿæˆè¿›ä¸€æ­¥çš„æ€è€ƒé—®é¢˜

# é¡¹ç›®å»ºè®®
æ ¹æ®é¡¹ç›®å†å²ï¼Œæä¾›ä¼˜åŒ–å»ºè®®
```

**æ™ºèƒ½ç”Ÿæˆç­–ç•¥**ï¼š
- åˆ†æå†å²æ¨¡å¼è¯†åˆ«å…´è¶£ç‚¹
- è‡ªé€‚åº”ç”¨æˆ·å­¦ä¹ è¿›åº¦
- æ”¯æŒå¤šç§è¾“å‡ºé£æ ¼

### ğŸ“Š get_status - æœåŠ¡çŠ¶æ€ç›‘æ§
**åŠŸèƒ½**ï¼šè·å–SageæœåŠ¡çš„è¿è¡ŒçŠ¶æ€å’Œç»Ÿè®¡ä¿¡æ¯
**è¾“å…¥å‚æ•°**ï¼šæ— 

**ä½¿ç”¨åœºæ™¯**ï¼š
```text
# å¥åº·æ£€æŸ¥
æ£€æŸ¥SageæœåŠ¡çŠ¶æ€

# ç»Ÿè®¡ä¿¡æ¯
æ˜¾ç¤ºè®°å¿†æ•°é‡å’ŒæœåŠ¡è¿è¡Œæ—¶é—´

# æ€§èƒ½ç›‘æ§
æŸ¥çœ‹ç³»ç»Ÿèµ„æºä½¿ç”¨æƒ…å†µ
```

**ç›‘æ§æŒ‡æ ‡**ï¼š
- æ•°æ®åº“è¿æ¥çŠ¶æ€
- è®°å¿†æ€»æ•°å’Œä¼šè¯æ•°é‡
- æœåŠ¡è¿è¡Œæ—¶é•¿å’Œå¥åº·çŠ¶æ€
- ç¼“å­˜å‘½ä¸­ç‡å’Œæ€§èƒ½æŒ‡æ ‡

### ğŸ¯ å·¥å…·ä½¿ç”¨æœ€ä½³å®è·µ

**è®°å¿†ç®¡ç†å·¥ä½œæµ**ï¼š
```text
1. åˆ›å»ºä¸“é¢˜ä¼šè¯ â†’ manage_session (action: create)
2. è¿›è¡Œä¸“é¢˜è®¨è®º â†’ è‡ªåŠ¨Hookæ•è·æˆ–æ‰‹åŠ¨ S
3. æŸ¥æ‰¾ç›¸å…³å†å² â†’ get_context (query: ç›¸å…³ä¸»é¢˜)
4. è·å–å­¦ä¹ å»ºè®® â†’ generate_prompt (context: å­¦ä¹ è¿›åº¦)
5. ç›‘æ§ç³»ç»ŸçŠ¶æ€ â†’ get_status
```

**é«˜æ•ˆæœç´¢æŠ€å·§**ï¼š
- ä½¿ç”¨å…·ä½“çš„æŠ€æœ¯æœ¯è¯­æé«˜ç²¾ç¡®åº¦
- ç»“åˆæ—¶é—´èŒƒå›´ï¼š"æœ€è¿‘å…³äºAPIè®¾è®¡çš„è®¨è®º"
- å¤šå…³é”®è¯ç»„åˆï¼š"Python å¼‚æ­¥ç¼–ç¨‹ æœ€ä½³å®è·µ"
- é—®é¢˜å¯¼å‘æœç´¢ï¼š"å¦‚ä½•è§£å†³å†…å­˜æ³„æ¼é—®é¢˜"

### é«˜çº§ç”¨æ³•

#### æ™ºèƒ½åœºæ™¯è¯†åˆ«
Sage ä¼šè‡ªåŠ¨è¯†åˆ«æ‚¨çš„å·¥ä½œåœºæ™¯å¹¶è°ƒæ•´ç­–ç•¥ï¼š

```text
# ç¼–ç¨‹åœºæ™¯ - è‡ªåŠ¨å¼ºè°ƒä»£ç ç¤ºä¾‹å’ŒæŠ€æœ¯ç»†èŠ‚
ç”¨æˆ·ï¼šå¦‚ä½•å®ç°ä¸€ä¸ªè£…é¥°å™¨ï¼Ÿ
Sageï¼š[è¯†åˆ«ç¼–ç¨‹åœºæ™¯ï¼Œæä¾›ä»£ç ç¤ºä¾‹å’Œä¹‹å‰çš„ç›¸å…³è®¨è®º]

# è°ƒè¯•åœºæ™¯ - è‡ªåŠ¨å…³è”é”™è¯¯æ¨¡å¼å’Œè§£å†³æ–¹æ¡ˆ
ç”¨æˆ·ï¼šTypeError: 'NoneType' object is not subscriptable
Sageï¼š[è¯†åˆ«è°ƒè¯•åœºæ™¯ï¼Œæä¾›ç±»ä¼¼é”™è¯¯çš„å†å²è§£å†³æ–¹æ¡ˆ]

# å­¦ä¹ åœºæ™¯ - è‡ªåŠ¨æ„å»ºçŸ¥è¯†è·¯å¾„
ç”¨æˆ·ï¼šæˆ‘æƒ³å­¦ä¹ æœºå™¨å­¦ä¹ 
Sageï¼š[è¯†åˆ«å­¦ä¹ åœºæ™¯ï¼Œæä¾›ç³»ç»ŸåŒ–çš„å­¦ä¹ è·¯å¾„å’Œå†å²è¿›åº¦]
```

#### æ‰‹åŠ¨ä¿å­˜å¯¹è¯
```text
# ä¸ºé‡è¦å¯¹è¯æ·»åŠ æè¿°æ€§æ ‡é¢˜
ä¿å­˜æˆ‘ä»¬åˆšæ‰çš„è®¨è®ºï¼Œæ ‡è®°ä¸º"æ¶æ„è®¾è®¡-å¾®æœåŠ¡æ‹†åˆ†æ–¹æ¡ˆ"
```

#### é«˜æ•ˆæœç´¢æŠ€å·§
```text
# æœç´¢ç‰¹å®šå†…å®¹
æœç´¢æ‰€æœ‰å…³äº API è®¾è®¡çš„å†å²å¯¹è¯

# å¤šå…³é”®è¯æœç´¢ï¼ˆç©ºæ ¼åˆ†éš”ï¼‰
æœç´¢ Python è£…é¥°å™¨ é«˜çº§ç”¨æ³•

# çŸ­è¯­æœç´¢ï¼ˆä½¿ç”¨å¼•å·ï¼‰
æœç´¢ "äºŒå‰æœç´¢æ ‘åˆ é™¤"
```

#### å¯¼å‡ºè®°å¿†
```text
# å¯¼å‡ºä¸º markdown æ ¼å¼
å°†ä»Šå¤©çš„æ‰€æœ‰å¯¹è¯å¯¼å‡ºä¸º markdown æ ¼å¼

# å¯¼å‡ºç‰¹å®šä¼šè¯
å¯¼å‡ºå½“å‰ä¼šè¯çš„æ‰€æœ‰å¯¹è¯
```

#### è®°å¿†ç®¡ç†æœ€ä½³å®è·µ
```text
# æŸ¥çœ‹ç³»ç»ŸçŠ¶æ€
è·å– Sage æœåŠ¡çŠ¶æ€

# åˆ†æè®°å¿†æ¨¡å¼
åˆ†ææˆ‘çš„è®°å¿†æ¨¡å¼

# åˆ›å»ºæ–°ä¼šè¯
åˆ›å»ºæ–°ä¼šè¯è¿›è¡Œç‹¬ç«‹é¡¹ç›®è®¨è®º
```

## ğŸ”§ é…ç½®è¯´æ˜

### ç¯å¢ƒå˜é‡

å¿…éœ€é…ç½®ï¼š
- `SILICONFLOW_API_KEY`: ç”¨äºå‘é‡åµŒå…¥çš„ API Key

å¯é€‰é…ç½®ï¼š
```bash
# è®°å¿†æ£€ç´¢é…ç½®
SAGE_MAX_RESULTS=5               # è¿”å›ç»“æœæ•°é‡
SAGE_SIMILARITY_THRESHOLD=0.5    # ç›¸ä¼¼åº¦é˜ˆå€¼

# æ€§èƒ½é…ç½®
SAGE_CACHE_SIZE=500              # ç¼“å­˜å¤§å°
SAGE_CACHE_TTL=300               # ç¼“å­˜è¿‡æœŸæ—¶é—´ï¼ˆç§’ï¼‰

# æ—¥å¿—é…ç½®
SAGE_DEBUG=false                 # è°ƒè¯•æ¨¡å¼
SAGE_LOG_LEVEL=INFO              # æ—¥å¿—çº§åˆ«
```

### Docker é…ç½®

æ•°æ®æŒä¹…åŒ–ï¼š
- æ•°æ®åº“ï¼š`sage-mcp-data` volume
- æ—¥å¿—ï¼š`sage-mcp-logs` volume

### æ—¶åŒºè®¾ç½®

é»˜è®¤ä½¿ç”¨åŒ—äº¬æ—¶é—´ï¼ˆUTC+8ï¼‰ã€‚å¦‚éœ€ä¿®æ”¹ï¼Œç¼–è¾‘ï¼š
- `docker/single/Dockerfile.single.minimal` - ä¿®æ”¹ `TZ` ç¯å¢ƒå˜é‡
- `docker/single/entrypoint.sh` - ä¿®æ”¹ PostgreSQL æ—¶åŒºé…ç½®

## ğŸ¨ é«˜çº§é…ç½®

### è‡ªå®šä¹‰é…ç½®æ–‡ä»¶

åœ¨ `.env` æ–‡ä»¶ä¸­å¯ä»¥é…ç½®ä»¥ä¸‹é«˜çº§é€‰é¡¹ï¼š

```bash
# æ£€ç´¢ç®—æ³•é…ç½®
SAGE_ENABLE_RERANK=true          # å¯ç”¨ç¥ç»ç½‘ç»œé‡æ’åº
SAGE_ENABLE_SUMMARY=true         # å¯ç”¨LLMå‹ç¼©æ‘˜è¦
SAGE_SIMILARITY_THRESHOLD=0.5    # è¯­ä¹‰ç›¸ä¼¼åº¦é˜ˆå€¼

# æŸ¥è¯¢ç±»å‹æƒé‡ï¼ˆè‡ªåŠ¨è¯†åˆ«åœºæ™¯ï¼‰
SAGE_QUERY_WEIGHTS='{"technical": {"semantic": 0.5, "temporal": 0.2, "context": 0.2, "keyword": 0.1}}'

# é¢„ç•™é…ç½®ï¼ˆæœªæ¥ç‰ˆæœ¬ï¼‰
SAGE_TRANSPARENT_MODE=false      # é€æ˜è®°å¿†æ¨¡å¼
SAGE_MODE_ON=false               # æ™ºèƒ½æ¨¡å¼
```

### æ€§èƒ½ä¼˜åŒ–æŠ€å·§

```bash
# å¢åŠ è¿”å›ç»“æœæ•°
export SAGE_MAX_RESULTS=10

# å¢å¤§ç¼“å­˜æé«˜å“åº”é€Ÿåº¦
export SAGE_CACHE_SIZE=1000

# å…³é—­é‡æ’åºä»¥æé€Ÿï¼ˆç‰ºç‰²ç²¾åº¦ï¼‰
export SAGE_ENABLE_RERANK=false
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### ç®¡ç†å‘½ä»¤

```bash
# ç¯å¢ƒæ£€æŸ¥
./scripts/check_environment.sh

# å¥åº·æ£€æŸ¥
./scripts/health_check.sh

# æ€§èƒ½æµ‹è¯•
./scripts/performance_test.sh

# é›†æˆæµ‹è¯•
./scripts/integration_test.sh

# å®æ—¶ç›‘æ§
./scripts/monitor.sh

# ä¸€é”®éƒ¨ç½²
./deploy.sh
```

### å®¹å™¨ç®¡ç†

```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker-compose ps

# é‡å¯æœåŠ¡
docker-compose restart

# åœæ­¢æœåŠ¡
docker-compose down

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f
```

### é‡å»ºé•œåƒ

```bash
# å¼ºåˆ¶é‡æ–°æ„å»º
./deploy.sh --force-rebuild

# æˆ–æ‰‹åŠ¨é‡å»º
docker-compose down
docker-compose build --no-cache
docker-compose up -d
```

### æ•°æ®åº“æ“ä½œ

```bash
# è¿›å…¥æ•°æ®åº“
docker exec -it sage-mcp psql -U sage -d sage_memory

# æŸ¥çœ‹è®°å¿†
SELECT id, user_input, created_at FROM memories ORDER BY created_at DESC LIMIT 10;

# æ•°æ®å¤‡ä»½
docker exec sage-mcp pg_dump -U sage sage_memory > backup_$(date +%Y%m%d).sql

# æ•°æ®æ¢å¤
cat backup_20240101.sql | docker exec -i sage-mcp psql -U sage -d sage_memory
```

### ç›‘æ§å’Œè°ƒè¯•

```bash
# å®æ—¶ç›‘æ§å®¹å™¨çŠ¶æ€
./scripts/monitor.sh --dashboard

# æŸ¥çœ‹è¯¦ç»†å¥åº·çŠ¶æ€
./scripts/health_check.sh --json

# æ€§èƒ½åŸºå‡†æµ‹è¯•
./scripts/performance_test.sh --report

# å®Œæ•´é›†æˆæµ‹è¯•
./scripts/integration_test.sh --cleanup
```

### æ¸…ç†æ•°æ®

```bash
# å®‰å…¨æ¸…ç†ï¼ˆä¿ç•™æ•°æ®ï¼‰
docker-compose down

# å®Œå…¨æ¸…ç†ï¼ˆåˆ é™¤æ•°æ®ï¼‰
./deploy.sh --cleanup
docker volume rm sage-data sage-logs

# æ¸…ç†é•œåƒ
docker rmi sage-mcp:latest
```

## ğŸ’¡ ä½¿ç”¨æŠ€å·§

### é«˜çº§æç¤ºè¯æŠ€å·§

1. **ä¸Šä¸‹æ–‡å¢å¼ºæç¤ºè¯**
   ```
   åŸºäºæˆ‘ä»¬ä¹‹å‰å…³äº[ä¸»é¢˜]çš„è®¨è®ºï¼Œè¯·æ·±å…¥è®²è§£[å…·ä½“é—®é¢˜]
   ```

2. **çŸ¥è¯†è¿æ¥æç¤ºè¯**
   ```
   ç»“åˆæˆ‘ä¹‹å‰å­¦ä¹ çš„[çŸ¥è¯†ç‚¹A]å’Œ[çŸ¥è¯†ç‚¹B]ï¼Œè§£é‡Š[æ–°æ¦‚å¿µ]
   ```

3. **é—®é¢˜è§£å†³æç¤ºè¯**
   ```
   æˆ‘ä¹‹å‰é‡åˆ°è¿‡ç±»ä¼¼çš„[é—®é¢˜ç±»å‹]ï¼Œè¿™æ¬¡çš„[å…·ä½“é—®é¢˜]åº”è¯¥å¦‚ä½•è§£å†³ï¼Ÿ
   ```

4. **å­¦ä¹ è·¯å¾„æç¤ºè¯**
   ```
   æ ¹æ®æˆ‘çš„å­¦ä¹ å†å²ï¼Œä¸‹ä¸€æ­¥æˆ‘åº”è¯¥å­¦ä¹ ä»€ä¹ˆæ¥æŒæ¡[ç›®æ ‡æŠ€èƒ½]ï¼Ÿ
   ```

### æ‰¹é‡æ“ä½œè„šæœ¬

```bash
#!/bin/bash
# æ‰¹é‡å¯¼å‡ºæ‰€æœ‰ä¼šè¯
sessions=$(docker exec sage-mcp psql -U sage -d sage_memory -t -c "SELECT id FROM sessions")
for session in $sessions; do
    echo "Exporting session: $session"
    # ä½¿ç”¨ Sage å·¥å…·å¯¼å‡º
done
```

## â“ å¸¸è§é—®é¢˜

### 1. Docker æœªè¿è¡Œ
**é”™è¯¯**ï¼š`Docker daemon æœªè¿è¡Œ`
**è§£å†³**ï¼šå¯åŠ¨ Docker Desktop

### 2. API Key æœªè®¾ç½®
**é”™è¯¯**ï¼š`SILICONFLOW_API_KEY ç¯å¢ƒå˜é‡æœªè®¾ç½®`
**è§£å†³**ï¼š
- æ£€æŸ¥ `.env` æ–‡ä»¶
- æˆ–è®¾ç½®ç¯å¢ƒå˜é‡ï¼š`export SILICONFLOW_API_KEY="sk-xxx"`

### 3. å®¹å™¨å¯åŠ¨å¤±è´¥
**æ’æŸ¥æ­¥éª¤**ï¼š
```bash
# æŸ¥çœ‹å®¹å™¨çŠ¶æ€
docker ps -a | grep sage

# æŸ¥çœ‹é”™è¯¯æ—¥å¿—
docker logs sage-mcp
```

### 4. è®°å¿†æœªä¿å­˜
**åŸå› **ï¼šå½“å‰ç‰ˆæœ¬éœ€è¦æ‰‹åŠ¨ä¿å­˜
**è§£å†³**ï¼šä½¿ç”¨"ä¿å­˜å¯¹è¯"å‘½ä»¤

### 5. æ„å»ºé€Ÿåº¦æ…¢
**è§£å†³**ï¼š
- ä½¿ç”¨å›½å†… Docker é•œåƒæº
- ç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®š

### 6. Connection reset by peer é”™è¯¯
**ç—‡çŠ¶**ï¼šDocker å®¹å™¨è¿è¡Œæ­£å¸¸ï¼Œä½†ä»ç„¶æŠ¥è¿æ¥é”™è¯¯
**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# ä½¿ç”¨å¥åº·æ£€æŸ¥å·¥å…·è¯Šæ–­
./scripts/health_check.sh

# æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
docker-compose logs sage-mcp

# é‡å¯æœåŠ¡
docker-compose restart
```

### 7. éƒ¨ç½²å¤±è´¥
**è¯Šæ–­å·¥å…·**ï¼š
```bash
# ç¯å¢ƒæ£€æŸ¥
./scripts/check_environment.sh --fix

# é›†æˆæµ‹è¯•
./scripts/integration_test.sh

# æŸ¥çœ‹éƒ¨ç½²æ—¥å¿—
tail -f deploy.log
```

### 8. æ€§èƒ½é—®é¢˜
**ç›‘æ§å·¥å…·**ï¼š
```bash
# å®æ—¶ç›‘æ§
./scripts/monitor.sh --alerts

# æ€§èƒ½æµ‹è¯•
./scripts/performance_test.sh --concurrent 10

# èµ„æºä½¿ç”¨åˆ†æ
docker stats sage-mcp
```

### 9. æœåŠ¡ç®¡ç†
**ç®¡ç†å‘½ä»¤**ï¼š
```bash
# æœåŠ¡çŠ¶æ€
./scripts/health_check.sh

# é‡å¯æœåŠ¡
docker-compose restart

# æŸ¥çœ‹è¿›ç¨‹
docker exec sage-mcp supervisorctl status
```

## ğŸ—„ï¸ æ•°æ®åº“ç»“æ„è¯¦è§£

### ğŸ“Š PostgreSQL + pgvector æ¶æ„
Sageä½¿ç”¨PostgreSQL 15ä½œä¸ºæ•°æ®å­˜å‚¨åç«¯ï¼Œé›†æˆpgvectoræ‰©å±•æ”¯æŒé«˜ç»´å‘é‡å­˜å‚¨å’Œç›¸ä¼¼åº¦æœç´¢ã€‚

### ğŸ“‹ æ ¸å¿ƒæ•°æ®è¡¨

#### 1. memories è¡¨ - è®°å¿†å­˜å‚¨
```sql
CREATE TABLE memories (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    session_id VARCHAR(255),                      -- ä¼šè¯éš”ç¦»
    user_input TEXT NOT NULL,                     -- ç”¨æˆ·è¾“å…¥
    assistant_response TEXT NOT NULL,             -- åŠ©æ‰‹å“åº”
    embedding vector(4096),                       -- 4096ç»´è¯­ä¹‰å‘é‡
    metadata JSONB DEFAULT '{}',                  -- æ‰©å±•å…ƒæ•°æ®
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- æ€§èƒ½ä¼˜åŒ–ç´¢å¼•
CREATE INDEX idx_memories_session_id ON memories(session_id);
CREATE INDEX idx_memories_created_at ON memories(created_at DESC);
-- æ³¨æ„ï¼š4096ç»´å‘é‡è¶…è¿‡pgvectorç´¢å¼•é™åˆ¶ï¼Œä½¿ç”¨åºåˆ—æ‰«æ
```

#### 2. sessions è¡¨ - ä¼šè¯ç®¡ç†
```sql
CREATE TABLE sessions (
    id VARCHAR(255) PRIMARY KEY,                 -- ä¼šè¯å”¯ä¸€æ ‡è¯†
    name VARCHAR(255),                           -- ä¼šè¯æ˜¾ç¤ºåç§°
    metadata JSONB DEFAULT '{}',                 -- ä¼šè¯å…ƒæ•°æ®
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    last_active TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);

-- æ´»è·ƒåº¦ç´¢å¼•
CREATE INDEX idx_sessions_last_active ON sessions(last_active DESC);
```

### ğŸ”§ æ•°æ®åº“ç‰¹æ€§

**æ—¶åŒºæ„ŸçŸ¥è®¾è®¡**ï¼š
- æ‰€æœ‰æ—¶é—´æˆ³ä½¿ç”¨`TIMESTAMP WITH TIME ZONE`
- é»˜è®¤åŒ—äº¬æ—¶é—´(Asia/Shanghai)
- è‡ªåŠ¨å¤„ç†å¤ä»¤æ—¶è½¬æ¢

**å‘é‡å­˜å‚¨ä¼˜åŒ–**ï¼š
- 4096ç»´å‘é‡ï¼šåŒ¹é…SiliconFlow APIè¾“å‡º
- é¿å¼€pgvector 2000ç»´ç´¢å¼•é™åˆ¶
- ä½¿ç”¨åºåˆ—æ‰«æé…åˆåº”ç”¨å±‚ç¼“å­˜

**è‡ªåŠ¨æ›´æ–°è§¦å‘å™¨**ï¼š
```sql
-- è‡ªåŠ¨æ›´æ–°æ—¶é—´æˆ³
CREATE OR REPLACE FUNCTION update_updated_at_column()
RETURNS TRIGGER AS $$
BEGIN
    NEW.updated_at = CURRENT_TIMESTAMP;
    RETURN NEW;
END;
$$ language 'plpgsql';
```

**æƒé™æ§åˆ¶**ï¼š
- æœ€å°æƒé™åŸåˆ™ï¼šsageç”¨æˆ·ä»…èƒ½è®¿é—®å¿…è¦è¡¨
- æ‰©å±•æƒé™ï¼šæ”¯æŒå‘é‡æ“ä½œå’Œè‡ªå®šä¹‰å‡½æ•°
- è¿æ¥éš”ç¦»ï¼šå®¹å™¨ç½‘ç»œå†…éƒ¨è®¿é—®

## ğŸ³ è·¨å¹³å°Dockeré•œåƒæ‰“åŒ…æŒ‡å—

### ğŸ“¦ æ„å»ºç¯å¢ƒè¦æ±‚

#### Windows ç¯å¢ƒ
```powershell
# 1. å®‰è£…Docker Desktop for Windows
# ä¸‹è½½ï¼šhttps://www.docker.com/products/docker-desktop/

# 2. å¯ç”¨WSL 2 Backendï¼ˆæ¨èï¼‰
# è®¾ç½® â†’ General â†’ Use the WSL 2 based engine

# 3. éªŒè¯Dockerå®‰è£…
docker --version
docker-compose --version

# 4. ç¡®ä¿è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ï¼ˆæ¨èè‡³å°‘5GBï¼‰
```

#### macOS ç¯å¢ƒ  
```bash
# 1. å®‰è£…Docker Desktop for Mac
# ä¸‹è½½ï¼šhttps://www.docker.com/products/docker-desktop/

# 2. éªŒè¯å®‰è£…
docker --version
docker-compose --version

# 3. é…ç½®èµ„æºé™åˆ¶ï¼ˆæ¨èï¼‰
# Docker Desktop â†’ Settings â†’ Resources
# Memory: 4GB+, CPU: 2æ ¸+
```

#### Linux ç¯å¢ƒ
```bash
# 1. å®‰è£…Docker Engine
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# 2. å®‰è£…Docker Compose
sudo pip3 install docker-compose

# 3. é…ç½®ç”¨æˆ·æƒé™
sudo usermod -aG docker $USER
newgrp docker
```

### ğŸ”¨ é•œåƒæ„å»ºæµç¨‹

#### æ–¹å¼ä¸€ï¼šä¸€é”®æ„å»ºï¼ˆæ¨èï¼‰
```bash
# 1. å…‹éš†é¡¹ç›®
git clone https://github.com/jetgogoing/Sage.git
cd Sage

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œè®¾ç½® SILICONFLOW_API_KEY

# 3. ä¸€é”®éƒ¨ç½²
./deploy.sh

# 4. éªŒè¯æ„å»º
docker images | grep sage-mcp
docker-compose ps
```

#### æ–¹å¼äºŒï¼šæ‰‹åŠ¨æ„å»º
```bash
# 1. æ„å»ºé•œåƒ
docker-compose build --no-cache

# 2. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 3. æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f sage-mcp

# 4. å¥åº·æ£€æŸ¥
docker exec sage-mcp pg_isready -U postgres
```

### ğŸ“ Pythonä¾èµ–å®‰è£…è¯¦è§£

#### requirements.txt è§£æ
```text
# MCPåè®®æ”¯æŒ
mcp>=1.1.0                    # Model Context Protocol SDK

# æ•°æ®åº“é©±åŠ¨  
asyncpg>=0.29.0               # PostgreSQLå¼‚æ­¥é©±åŠ¨

# ç§‘å­¦è®¡ç®—ï¼ˆå‘é‡æ“ä½œï¼‰
numpy>=1.24.0                 # æ•°å€¼è®¡ç®—åŸºç¡€åº“

# è®¤è¯å’Œå®‰å…¨
PyJWT>=2.8.0                  # JWT tokenå¤„ç†

# é…ç½®ç®¡ç†
python-dotenv>=1.0.0          # ç¯å¢ƒå˜é‡åŠ è½½

# å¼‚æ­¥æ–‡ä»¶æ“ä½œ  
aiofiles>=23.2.1              # å¼‚æ­¥æ–‡ä»¶è¯»å†™

# HTTPè¯·æ±‚
requests>=2.31.0              # å‘é‡åŒ–APIè°ƒç”¨
```

#### å„å¹³å°å®‰è£…æŒ‡å—

**Windows å®‰è£…**ï¼š
```powershell
# 1. å®‰è£…Python 3.10+
# ä»Microsoft Storeæˆ–python.orgä¸‹è½½

# 2. éªŒè¯å®‰è£…
python --version
pip --version

# 3. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python -m venv sage_env
sage_env\Scripts\activate

# 4. å®‰è£…ä¾èµ–
cd Sage
pip install -r requirements.txt

# 5. éªŒè¯å®‰è£…
python -c "import mcp; print('MCP SDK installed successfully')"
```

**macOS å®‰è£…**ï¼š
```bash
# 1. å®‰è£…Pythonï¼ˆé€šè¿‡Homebrewæ¨èï¼‰
brew install python@3.10

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv sage_env
source sage_env/bin/activate

# 3. å‡çº§pip
pip install --upgrade pip

# 4. å®‰è£…ä¾èµ–
cd Sage
pip install -r requirements.txt

# 5. éªŒè¯å®‰è£…
python -c "import asyncpg; print('PostgreSQL driver ready')"
```

**Linux å®‰è£…**ï¼š
```bash
# 1. å®‰è£…Pythonå’Œå¼€å‘å·¥å…·
sudo apt update
sudo apt install python3.10 python3.10-venv python3-pip
# æˆ–è€… CentOS/RHEL: sudo yum install python3 python3-pip

# 2. åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv sage_env
source sage_env/bin/activate

# 3. å®‰è£…ä¾èµ–
cd Sage
pip install -r requirements.txt

# 4. å®‰è£…ç³»ç»Ÿä¾èµ–ï¼ˆå¦‚éœ€è¦ï¼‰
sudo apt-get install build-essential
```

### ğŸš€ é•œåƒä¼˜åŒ–æŠ€å·§

**å¤šé˜¶æ®µæ„å»º**ï¼š
```dockerfile
# ä¼˜åŒ–çš„Dockerfileç¤ºä¾‹
FROM python:3.10-slim AS builder
COPY requirements.txt .
RUN pip install --user -r requirements.txt

FROM python:3.10-slim
COPY --from=builder /root/.local /root/.local
# å‡å°‘é•œåƒå±‚æ•°å’Œå¤§å°
```

**ç¼“å­˜ä¼˜åŒ–**ï¼š
```bash
# ä½¿ç”¨BuildKitåŠ é€Ÿæ„å»º
export DOCKER_BUILDKIT=1
docker-compose build

# åˆ©ç”¨å±‚ç¼“å­˜
docker-compose build --parallel
```

**æ€§èƒ½è°ƒä¼˜**ï¼š
```bash
# è°ƒæ•´Docker Desktopèµ„æºé…ç½®
# Memory: 4GB+ ï¼ˆå‘é‡è®¡ç®—éœ€è¦ï¼‰
# CPU: 2æ ¸+ ï¼ˆPostgreSQL + Pythonï¼‰
# Disk: 20GB+ ï¼ˆæ•°æ®åº“æ•°æ®ï¼‰
```

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

```
sage/
â”œâ”€â”€ .mcp.json                         # MCP é…ç½®æ–‡ä»¶
â”œâ”€â”€ .env.example                      # ç¯å¢ƒå˜é‡æ¨¡æ¿
â”œâ”€â”€ deploy.sh                         # ä¸€é”®éƒ¨ç½²è„šæœ¬
â”œâ”€â”€ docker-compose.yml               # Dockerç¼–æ’é…ç½®
â”œâ”€â”€ requirements.txt                  # Pythonä¾èµ–æ¸…å•
â”œâ”€â”€ scripts/                          # ç®¡ç†è„šæœ¬
â”‚   â”œâ”€â”€ sage_mcp_stdio_wrapper.sh     # MCPå¯åŠ¨åŒ…è£…å™¨
â”‚   â”œâ”€â”€ check_environment.sh          # ç¯å¢ƒæ£€æŸ¥å·¥å…·
â”‚   â”œâ”€â”€ health_check.sh              # å¥åº·æ£€æŸ¥è„šæœ¬
â”‚   â””â”€â”€ monitor.sh                   # å®æ—¶ç›‘æ§å·¥å…·
â”œâ”€â”€ docker/                          # Dockeré…ç½®
â”‚   â””â”€â”€ single/
â”‚       â”œâ”€â”€ Dockerfile.single.minimal  # æœ€å°åŒ–é•œåƒå®šä¹‰
â”‚       â”œâ”€â”€ entrypoint.sh             # å®¹å™¨å¯åŠ¨è„šæœ¬
â”‚       â””â”€â”€ init.sql                  # æ•°æ®åº“åˆå§‹åŒ–SQL
â”œâ”€â”€ sage_core/                        # æ ¸å¿ƒåŠŸèƒ½æ¨¡å—
â”‚   â”œâ”€â”€ __init__.py                   # åŒ…åˆå§‹åŒ–
â”‚   â”œâ”€â”€ singleton_manager.py          # å•ä¾‹ç®¡ç†å™¨
â”‚   â”œâ”€â”€ memory/                       # è®°å¿†ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ manager.py                # è®°å¿†ç®¡ç†å™¨
â”‚   â”‚   â”œâ”€â”€ storage.py                # å­˜å‚¨å±‚
â”‚   â”‚   â””â”€â”€ vectorizer.py             # å‘é‡åŒ–å™¨
â”‚   â”œâ”€â”€ database/                     # æ•°æ®åº“æ“ä½œ
â”‚   â”‚   â”œâ”€â”€ connection.py             # è¿æ¥ç®¡ç†
â”‚   â”‚   â””â”€â”€ transaction.py            # äº‹åŠ¡ç®¡ç†
â”‚   â”œâ”€â”€ config/                       # é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ manager.py                # é…ç½®ç®¡ç†å™¨
â”‚   â”œâ”€â”€ interfaces/                   # æ¥å£å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ memory.py                 # è®°å¿†æ¥å£
â”‚   â”‚   â””â”€â”€ turn.py                   # å¯¹è¯è½®æ¬¡æ¨¡å‹
â”‚   â””â”€â”€ resilience/                   # å®¹é”™æœºåˆ¶
â”‚       â”œâ”€â”€ circuit_breaker.py        # ç†”æ–­å™¨
â”‚       â””â”€â”€ retry_strategy.py         # é‡è¯•ç­–ç•¥
â”œâ”€â”€ hooks/                            # Hookè„šæœ¬
â”‚   â”œâ”€â”€ scripts/
â”‚   â”‚   â”œâ”€â”€ sage_stop_hook_simple.py  # ç®€åŒ–åœæ­¢Hook
â”‚   â”‚   â””â”€â”€ hook_data_aggregator.py   # æ•°æ®èšåˆå™¨
â”‚   â””â”€â”€ configs/
â”‚       â””â”€â”€ sage_hooks.json           # Hooké…ç½®
â”œâ”€â”€ sage_mcp_stdio_single.py          # MCPæœåŠ¡ä¸»æ–‡ä»¶
â”œâ”€â”€ data/                             # æ•°æ®ç›®å½•
â”‚   â”œâ”€â”€ postgresql/                   # æ•°æ®åº“æ•°æ®
â”‚   â””â”€â”€ logs/                         # æ—¥å¿—æ–‡ä»¶
â””â”€â”€ docs/                             # æ–‡æ¡£ç›®å½•
    â””â”€â”€ æ‰§è¡ŒæŠ¥å‘Š/                     # é¡¹ç›®æŠ¥å‘Š
```

## ğŸ” å®‰å…¨è¯´æ˜

- API Key è¯·å¦¥å–„ä¿ç®¡ï¼Œä¸è¦æäº¤åˆ°ä»£ç ä»“åº“
- é»˜è®¤é…ç½®ä»…é€‚ç”¨äºæœ¬åœ°å¼€å‘
- ç”Ÿäº§ç¯å¢ƒéœ€è¦é¢å¤–çš„å®‰å…¨é…ç½®

## ğŸ”¬ æŠ€æœ¯æ·±åº¦

### æŸ¥è¯¢ç±»å‹è‡ªé€‚åº”æƒé‡

Sage èƒ½å¤Ÿæ™ºèƒ½è¯†åˆ« 6 ç§æŸ¥è¯¢ç±»å‹å¹¶åŠ¨æ€è°ƒæ•´æ£€ç´¢ç­–ç•¥ï¼š

```python
# æŠ€æœ¯æŸ¥è¯¢ - é‡è§†è¯­ä¹‰ç›¸ä¼¼åº¦
QueryType.TECHNICAL: {
    'semantic': 0.5,    # è¯­ä¹‰åŒ¹é…ä¼˜å…ˆ
    'temporal': 0.2,    
    'context': 0.2,
    'keyword': 0.1      # æŠ€æœ¯å…³é”®è¯
}

# å¯¹è¯æŸ¥è¯¢ - é‡è§†æ—¶é—´è¿ç»­æ€§
QueryType.CONVERSATIONAL: {
    'semantic': 0.3,
    'temporal': 0.4,    # æ—¶åºä¼˜å…ˆ
    'context': 0.3,     # ä¸Šä¸‹æ–‡ç›¸å…³
    'keyword': 0.0
}
```

### å¤šé˜¶æ®µæ£€ç´¢æµç¨‹

```
æŸ¥è¯¢ â†’ å‘é‡æ£€ç´¢(Top 20) â†’ é‡æ’åº(Top 10) â†’ ä¸Šä¸‹æ–‡ç”Ÿæˆ
      â†“                    â†“                  â†“
   è¯­ä¹‰ç›¸ä¼¼åº¦          ç»¼åˆè¯„åˆ†           LLM å‹ç¼©
```

### æ€§èƒ½åŸºå‡†æµ‹è¯•

åœ¨ MacBook Pro M1 ä¸Šçš„æµ‹è¯•ç»“æœï¼š

| æŒ‡æ ‡ | ç›®æ ‡å€¼ | å®æµ‹å€¼ | çŠ¶æ€ |
|------|--------|--------|------|
| æœåŠ¡å¯åŠ¨æ—¶é—´ | < 3s | 2.1s | âœ… |
| è®°å¿†æ£€ç´¢å»¶è¿Ÿ | < 500ms | 320ms | âœ… |
| ä¸Šä¸‹æ–‡æ³¨å…¥å¼€é”€ | < 100ms | 65ms | âœ… |
| ç³»ç»Ÿå†…å­˜å ç”¨ | < 200MB | 85MB | âœ… |
| ç¼“å­˜å‘½ä¸­ç‡ | > 70% | 82% | âœ… |

## ğŸ“ ç‰ˆæœ¬å†å²

### v1.2.1 (2025-07-25)
- ğŸš€ æ–°å¢ä¸€é”®éƒ¨ç½²è„šæœ¬ï¼ˆdeploy.shï¼‰
- ğŸ”§ æ–°å¢ç¯å¢ƒæ£€æŸ¥å·¥å…·ï¼ˆcheck_environment.shï¼‰
- ğŸ“Š æ–°å¢å®¹å™¨ç›‘æ§å·¥å…·ï¼ˆmonitor.shï¼‰
- ğŸ§ª æ–°å¢å¥åº·æ£€æŸ¥å’Œæ€§èƒ½æµ‹è¯•å·¥å…·
- ğŸ› ï¸ æ–°å¢é›†æˆæµ‹è¯•æ¡†æ¶
- ğŸ“š å®Œå–„éƒ¨ç½²æ–‡æ¡£å’Œæ•…éšœæ’æŸ¥æŒ‡å—
- ğŸ”’ å¢å¼ºå®‰å…¨é…ç½®å’Œç½‘ç»œç­–ç•¥
- ğŸ’¾ ä¼˜åŒ–æ•°æ®æŒä¹…åŒ–å’Œå¤‡ä»½ç­–ç•¥

### v1.1.2 (2025-01-17)
- ğŸ› ä¿®å¤å‘é‡æ•°æ®åº“å­˜å‚¨åŠŸèƒ½
- ğŸ• æ·»åŠ åŒ—äº¬æ—¶åŒºæ”¯æŒ
- ğŸš€ ä¼˜åŒ–å¯åŠ¨è„šæœ¬
- ğŸ“š æ›´æ–°æ–‡æ¡£å’Œéƒ¨ç½²æŒ‡å—

### v1.1.1 (2025-01-17)
- ğŸ”§ ä¿®å¤æ•°æ®åº“æƒé™é—®é¢˜
- ğŸ› ä¿®å¤ç¯å¢ƒå˜é‡å‘½åé—®é¢˜
- ğŸ“Š ä¿®å¤å‘é‡æ ¼å¼é”™è¯¯
- ğŸ“š æ·»åŠ è¯¦ç»†æ•…éšœæ’é™¤æŒ‡å—

### v1.1.0 (2025-01-16)
- ğŸ¯ å®ç° stdio é€šä¿¡æ¨¡å¼
- ğŸ“¦ å•å®¹å™¨æ¶æ„è®¾è®¡
- âš¡ ç®€åŒ–éƒ¨ç½²æµç¨‹

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

1. Fork é¡¹ç›®
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤æ›´æ”¹ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. æäº¤ Pull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…

## ğŸ™ è‡´è°¢

- [Claude](https://claude.ai) - AI åŠ©æ‰‹
- [MCP](https://modelcontextprotocol.io) - Model Context Protocol
- [pgvector](https://github.com/pgvector/pgvector) - PostgreSQL å‘é‡æ‰©å±•
- [SiliconFlow](https://siliconflow.cn) - å‘é‡åµŒå…¥æœåŠ¡

---

<div align="center">
Made with â¤ï¸ for Claude users
</div>